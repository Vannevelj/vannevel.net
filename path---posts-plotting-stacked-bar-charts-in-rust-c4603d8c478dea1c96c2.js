webpackJsonp([48914037011886],{509:function(n,a){n.exports={data:{site:{siteMetadata:{title:"To kill a mocking bug",subtitle:"Unearthing curious .NET behaviour",author:{name:"Jeroen Vannevel",twitter:"VannevelJeroen"},disqusShortname:"",url:"https://vannevel.net"}},markdownRemark:{id:"/Users/jeroenvannevel/Documents/source/vannevel.net/src/pages/articles/2022-05-03---Plotting-Stacked-Bar-Charts-In-Rust/index.md absPath of file >>> MarkdownRemark",html:'<p>A while ago I wrote a post on how I generated <a href="https://vannevel.net/posts/visualizing-the-language-migration-of-a-codebase">a visualization of the language migration in a codebase</a>. As time passed I referred back to it on several occassions but it quickly started to frustrate me: the poor dependency management experience required a bunch of manual setup steps which I don’t want to do every time I setup a new laptop. On top of that, the dependencies themselves sometimes broke because something else on the system changed (see my note at the bottom) and I’ve always felt a bit uneasy that there’s a manual step involved to actually create the graph.</p>\n<p>As I am diving into Rust, this felt like a great opportunity to get rid of some dependencies and get it all contained in a single binary. This brings me to <a href="https://github.com/Vannevelj/lingo-rs">lingo-rs</a>: a self-contained Rust application available on Windows, Mac &#x26; Linux which will generate a graph of a repo’s language distribution over time.</p>\n<p>It consists of three main aspects:</p>\n<ul>\n<li><a href="https://github.com/Vannevelj/lingo-rs/blob/6b3c2574722bb29f4368e6ad3925069ac789e6af/src/main.rs">Repository handling behaviour</a>, such as checking out the branch on different dates</li>\n<li><a href="https://github.com/Vannevelj/lingo-rs/blob/6b3c2574722bb29f4368e6ad3925069ac789e6af/src/main.rs#L141-L191">Content analysis</a>, to figure out which files belong to what language and which can be ignored</li>\n<li><a href="https://github.com/Vannevelj/lingo-rs/blob/6b3c2574722bb29f4368e6ad3925069ac789e6af/src/graph.rs">Graph generation</a>, to display the results in an intuitive manner</li>\n</ul>\n<h1>Creating a stacked bar chart</h1>\n<p><a href="https://github.com/plotters-rs/plotters">Plotters</a> is a powerful library to create data visualizations and provides a lot of functionality in the form of straightforward helper functions. One thing that is less obvious though is how to create a stacked chart (i.e. values are normalized between 0% and 100%).</p>\n<p>In this example we’ll walk through the steps on how to create your own chart with stacked values.\nLet’s start by creating our repo and adding a few dependencies:</p>\n<div class="gatsby-highlight">\n      <pre class="language-sh"><code class="language-sh">cargo new plotters-example\ncd plotters-example</code></pre>\n      </div>\n<p><strong>cargo.toml</strong></p>\n<div class="gatsby-highlight">\n      <pre class="language-toml"><code class="language-toml">[package]\nname = &quot;plotters-example&quot;\nversion = &quot;0.1.0&quot;\nedition = &quot;2021&quot;\n\n[dependencies]\nchrono = &quot;0.4.19&quot;\nplotters = &quot;0.3.1&quot;</code></pre>\n      </div>\n<p>Let’s start by creating a bit of test data:</p>\n<div class="gatsby-highlight">\n      <pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> chrono<span class="token punctuation">:</span><span class="token punctuation">:</span>NaiveDate<span class="token punctuation">;</span>\n<span class="token keyword">use</span> plotters<span class="token punctuation">:</span><span class="token punctuation">:</span>style<span class="token punctuation">:</span><span class="token punctuation">:</span>RGBColor<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> Entry <span class="token punctuation">{</span>\n    date<span class="token punctuation">:</span> NaiveDate<span class="token punctuation">,</span>\n    value<span class="token punctuation">:</span> f64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> <span class="token function">Summary</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> RGBColor<span class="token punctuation">,</span> Vec<span class="token operator">&lt;</span>Entry<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">create_date</span><span class="token punctuation">(</span>date<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> NaiveDate <span class="token punctuation">{</span>\n    NaiveDate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">create_summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Vec<span class="token operator">&lt;</span>Summary<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">vec!</span><span class="token punctuation">[</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">15.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">25.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">30.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 3"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">40.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> data_for_graph <span class="token operator">=</span> <span class="token function">create_summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>This will give us a few days worth of data, grouped in three series with a hardcoded color each. Our next step is to provide plotters-rs with an output file and some basic chart setup:</p>\n<div class="gatsby-highlight">\n      <pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> root <span class="token operator">=</span> BitMapBackend<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"output.png"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_drawing_area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nroot<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to set chart background"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> <span class="token keyword">mut</span> chart <span class="token operator">=</span> ChartBuilder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>root<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">caption</span><span class="token punctuation">(</span><span class="token string">"Example"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"sans-serif"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">set_label_area_size</span><span class="token punctuation">(</span>LabelAreaPosition<span class="token punctuation">:</span><span class="token punctuation">:</span>Left<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">set_label_area_size</span><span class="token punctuation">(</span>LabelAreaPosition<span class="token punctuation">:</span><span class="token punctuation">:</span>Bottom<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">build_cartesian_2d</span><span class="token punctuation">(</span>\n      Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">..</span>Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-04"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">0.00001</span><span class="token punctuation">..</span><span class="token number">101.0</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to set chart axis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nchart\n  <span class="token punctuation">.</span><span class="token function">configure_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">disable_x_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">disable_y_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">y_label_formatter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">|</span>x<span class="token operator">|</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:.2}%"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">y_desc</span><span class="token punctuation">(</span><span class="token string">"Prevalence"</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to render mesh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>We define our 2D plane with dates on the X-axis. The Y-axis we use a little bit of trickery to ensure that plotters-rs always starts at 0 and displays the 100 label.</p>\n<p>At this point we can run our code and we see it generated an empty chart with Y-labels for 0 and 100:</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/output-empty-aa5600780a9d3a6e5c84ff140a70c390-54aa9.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAAAj0lEQVQoz82TyQrDIBCGff+38+ATKJ48KFZc6tIfU0qpSQpCMN9hDs6Ms5OccymlfVFrheScU0oZY0KIz+MP5NEZFbB+dvB7O4DAKKXUpiDOOWvtpDMS895POqNbMcYVaRtjTvr5P3IIYUXa2zLcb861c9mcpZQIHvdQSqEoLP+o0lq/D2M7zBEYoa5dFbxedMG1maTtl/UAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Empty chart with labels"\n        title=""\n        src="/static/output-empty-aa5600780a9d3a6e5c84ff140a70c390-54aa9.png"\n        srcset="/static/output-empty-aa5600780a9d3a6e5c84ff140a70c390-309c7.png 240w,\n/static/output-empty-aa5600780a9d3a6e5c84ff140a70c390-225b9.png 480w,\n/static/output-empty-aa5600780a9d3a6e5c84ff140a70c390-54aa9.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The next step is to draw some series through the <code class="language-text">chart.draw_series()</code> API:</p>\n<div class="gatsby-highlight">\n      <pre class="language-rust"><code class="language-rust"><span class="token keyword">for</span> summary <span class="token keyword">in</span> data_for_graph<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> color <span class="token operator">=</span> summary<span class="token number">.1</span><span class="token punctuation">;</span>\n\n  chart\n      <span class="token punctuation">.</span><span class="token function">draw_series</span><span class="token punctuation">(</span>summary<span class="token number">.2</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>entry<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> x0 <span class="token operator">=</span> Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">let</span> x1 <span class="token operator">=</span> Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Duration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">days</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">let</span> <span class="token keyword">mut</span> bar <span class="token operator">=</span> Rectangle<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          bar<span class="token punctuation">.</span><span class="token function">set_margin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          bar\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to draw series"</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token punctuation">|</span>(x<span class="token punctuation">,</span> y)<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n          PathElement<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">vec!</span><span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span><span class="token function">stroke_width</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>summary<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>For each series we draw the entry. The entry is drawn for a particular date (i.e. the horizontal axis) and we return a <code class="language-text">Rectangle</code> with the height of our value.</p>\n<p>However if we now print this out, we can see that only the blue graph is displayed:</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/output-intermediate-89db30c761e0012d5d278d675896a6b1-54aa9.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABcklEQVQoz52Tu4rCQBSG47X0QgoL8QEEBUGiYGet+DCCotGUYmuKgD7I1t7AUhC0s1O22S12VyWZJDNnzzjiZkXWxcPP4edj/pnJHCK5rkspBU8xxrDvdrvVarXZbPb7/RXelHQ8Fzrc4SpcSSkjxEE5jivgnTBuads2PFUSIaft9jCdwmx20WQCyyUsFiDgfA7jMazX98IAjmGYkgTBIPj9vKNXFIjHuUESCnFTq4nnuA1TwyBi3bXn8xCLcYMKBHivVu+HT7p+eDr8ORq5z59sGNbDcKXCk6YJlnURIefwYPDXtQUpFqFUgnQaMhnIZrkpl3mYDYfOwzCSaPRCfD7eE4l/n4xEDA+TgiSTnjmHw3zI2NEXCkyWmRi+IIryQ8TkU6nznHWdXB9G7JrLQSTy62QvEdeWZZAoPb28vNbrZrdLVJV0OqTRsHq9N007ttu2IM0m6fffVfVLEFSrRTTtA8OMUvwxXLyCRwQ/5xGxvwG/qHp8dhLWJwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Chart with only one series"\n        title=""\n        src="/static/output-intermediate-89db30c761e0012d5d278d675896a6b1-54aa9.png"\n        srcset="/static/output-intermediate-89db30c761e0012d5d278d675896a6b1-309c7.png 240w,\n/static/output-intermediate-89db30c761e0012d5d278d675896a6b1-225b9.png 480w,\n/static/output-intermediate-89db30c761e0012d5d278d675896a6b1-54aa9.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>This happens because all three charts are rendered right on top of each other starting at Y-value <code class="language-text">0</code>. Blue is our last series to draw so it ends up layered above the others.</p>\n<p>The solution here is to calculate the cumulative percentage of each series for a given day and then use that to offset the series we render. There are a lot of ways to calculate this but for brevity purposes I’ve included a very crude way of doing so. In a production scenario with more data you should take a less wasteful approach.</p>\n<div class="gatsby-highlight">\n      <pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> entries_for_day<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span><span class="token operator">&amp;</span>Entry<span class="token operator">></span> <span class="token operator">=</span> data_for_graph\n    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">flat_map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> <span class="token operator">&amp;</span>m<span class="token number">.2</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token operator">|</span>f<span class="token operator">|</span> f<span class="token number">.0</span> <span class="token operator">==</span> entry<span class="token number">.0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nentries_for_day<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token operator">|</span>a<span class="token punctuation">,</span> b<span class="token operator">|</span> a<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> absolute_start<span class="token punctuation">:</span> f64 <span class="token operator">=</span> entries_for_day<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> m<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> total<span class="token punctuation">:</span> f64 <span class="token operator">=</span> entries_for_day<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> m<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> relative_start <span class="token operator">=</span> absolute_start <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> relative_length <span class="token operator">=</span> entry<span class="token number">.1</span> <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> <span class="token keyword">mut</span> bar <span class="token operator">=</span> Rectangle<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>\n    <span class="token punctuation">[</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> relative_start<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> relative_start <span class="token operator">+</span> relative_length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    color<span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>For each entry we will now calculate all the other entries for that same day. Based on this total, an index and a deterministic ordering of the elements, we can now calculate a vertical axis offset to avoid overlapping.</p>\n<p>And that’s it! If you now add the <code class="language-text">#[derive(Clone)]</code> directives and run your code, you will generate the following image:</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/output-final-65f38b1cded1728fe85cff58820789b4-54aa9.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACUUlEQVQoz4VTz2sTURCe/ZFFFLIbIj0k6B8QSpNm19qD9ODBXNSLUrQVxHrzWGlNk0ZPkotCAmnQHgTb0oNW0IMKevAkRKlSCQFP7aEKCh6qTYy7m/fGedm07NaCMAzDt/PNNzNvFhjruC5zHNw12+aIuL6+ubr6aW2tsbHxhXPCuT+HzHUREJtLS81EAi0L02k0Tezvx/FxHBnhiYQ7MOCmUp0dBJPJXg4FmYwg80rFAUBFQfKyLPzgIOq6CPZFJEn4vj5BbpXL2x6ZUK8EdRGJ9PL+Rbxy8bggu5VKe1fB89SYYQSU/YinHIsJMqtW7b1kC40IB+AgcVkRgWnxfcm9tgPkNBrBmf2In/zz/rwLwGSVgUy+I1JPbhmZGpg1OF6Th99B+q059tkId8lSUHmu/EcoeNvukq3rbyIowW9FclTF1ohibZ6NHKQEJtEgkhgkHuNiYaWndTjzSD6/AudW5NHHcOpZerGkowqiDshcIZ/+dlo/hN0t7DyVUOZ4z63SZxUVmi7EZIovN8yXF/SFi7BMNqYsj8KTycyJcCMJH0zpIxkFmVgdsIV3t0tCAUlBUjtC58ZrC8FwA1diOfphByQHQo6kUeDGjlLbWH819+ASLFzVHk6oixPa/BV4f20I9ahLjWtq54BG7bPhYxjtXokqY6i7niNxYIj2nTLuuc9kCsPhwFulfIg3dDQKLca+vnjenJps35ptF3Ltm/lWdup78XZztuDMzNi5nJ3P29PTP4rFX7lcDyHLZrcKBeCMOfRb0qH5zKY3+B/iIP4FO3HfB3yVuFAAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Stacked bar chart"\n        title=""\n        src="/static/output-final-65f38b1cded1728fe85cff58820789b4-54aa9.png"\n        srcset="/static/output-final-65f38b1cded1728fe85cff58820789b4-309c7.png 240w,\n/static/output-final-65f38b1cded1728fe85cff58820789b4-225b9.png 480w,\n/static/output-final-65f38b1cded1728fe85cff58820789b4-54aa9.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>For completeness’ sake, this is the full code:</p>\n<div class="gatsby-highlight">\n      <pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>ops<span class="token punctuation">:</span><span class="token punctuation">:</span>Add<span class="token punctuation">;</span>\n\n<span class="token keyword">use</span> chrono<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">{</span>Duration<span class="token punctuation">,</span> NaiveDate<span class="token punctuation">,</span> TimeZone<span class="token punctuation">,</span> Utc<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> plotters<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">{</span>\n    prelude<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">{</span>\n        BitMapBackend<span class="token punctuation">,</span> ChartBuilder<span class="token punctuation">,</span> IntoDrawingArea<span class="token punctuation">,</span> LabelAreaPosition<span class="token punctuation">,</span> PathElement<span class="token punctuation">,</span> Rectangle<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    style<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">{</span>Color<span class="token punctuation">,</span> IntoFont<span class="token punctuation">,</span> RGBColor<span class="token punctuation">,</span> WHITE<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Clone)]</span>\n<span class="token keyword">struct</span> Entry <span class="token punctuation">{</span>\n    date<span class="token punctuation">:</span> NaiveDate<span class="token punctuation">,</span>\n    value<span class="token punctuation">:</span> f64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token attribute attr-name">#[derive(Clone)]</span>\n<span class="token keyword">struct</span> <span class="token function">Summary</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> RGBColor<span class="token punctuation">,</span> Vec<span class="token operator">&lt;</span>Entry<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">create_date</span><span class="token punctuation">(</span>date<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> NaiveDate <span class="token punctuation">{</span>\n    NaiveDate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">create_summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Vec<span class="token operator">&lt;</span>Summary<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">vec!</span><span class="token punctuation">[</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">15.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">25.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">30.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Summary</span><span class="token punctuation">(</span>\n            String<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Option 3"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">RGBColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">vec!</span><span class="token punctuation">[</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                Entry <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-03"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">40.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> data_for_graph <span class="token operator">=</span> <span class="token function">create_summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> root <span class="token operator">=</span> BitMapBackend<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"output.png"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_drawing_area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    root<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to set chart background"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> chart <span class="token operator">=</span> ChartBuilder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>root<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">caption</span><span class="token punctuation">(</span><span class="token string">"Example"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"sans-serif"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">set_label_area_size</span><span class="token punctuation">(</span>LabelAreaPosition<span class="token punctuation">:</span><span class="token punctuation">:</span>Left<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">set_label_area_size</span><span class="token punctuation">(</span>LabelAreaPosition<span class="token punctuation">:</span><span class="token punctuation">:</span>Bottom<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">build_cartesian_2d</span><span class="token punctuation">(</span>\n            Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n                <span class="token punctuation">..</span>Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">create_date</span><span class="token punctuation">(</span><span class="token string">"2022-05-04"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token operator">-</span><span class="token number">0.00001</span><span class="token punctuation">..</span><span class="token number">101.0</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to set chart axis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    chart\n        <span class="token punctuation">.</span><span class="token function">configure_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">disable_x_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">disable_y_mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">y_label_formatter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">|</span>x<span class="token operator">|</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:.2}%"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">y_desc</span><span class="token punctuation">(</span><span class="token string">"Prevalence"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to render mesh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> summary<span class="token punctuation">)</span> <span class="token keyword">in</span> data_for_graph<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> color <span class="token operator">=</span> summary<span class="token number">.1</span><span class="token punctuation">;</span>\n\n        chart\n            <span class="token punctuation">.</span><span class="token function">draw_series</span><span class="token punctuation">(</span>summary<span class="token number">.2</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>entry<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n                <span class="token keyword">let</span> x0 <span class="token operator">=</span> Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">let</span> x1 <span class="token operator">=</span> Utc<span class="token punctuation">.</span><span class="token function">from_utc_date</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Duration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">days</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n                <span class="token keyword">let</span> <span class="token keyword">mut</span> entries_for_day<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span><span class="token operator">&amp;</span>Entry<span class="token operator">></span> <span class="token operator">=</span> data_for_graph\n                    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">flat_map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> <span class="token operator">&amp;</span>m<span class="token number">.2</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token operator">|</span>f<span class="token operator">|</span> f<span class="token punctuation">.</span>date <span class="token operator">==</span> entry<span class="token punctuation">.</span>date<span class="token punctuation">)</span>\n                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                entries_for_day<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token operator">|</span>a<span class="token punctuation">,</span> b<span class="token operator">|</span> a<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">let</span> absolute_start<span class="token punctuation">:</span> f64 <span class="token operator">=</span> entries_for_day<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> m<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">let</span> total<span class="token punctuation">:</span> f64 <span class="token operator">=</span> entries_for_day<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>m<span class="token operator">|</span> m<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n                <span class="token keyword">let</span> relative_start <span class="token operator">=</span> absolute_start <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>\n                <span class="token keyword">let</span> relative_length <span class="token operator">=</span> entry<span class="token punctuation">.</span>value <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>\n\n                <span class="token keyword">let</span> <span class="token keyword">mut</span> bar <span class="token operator">=</span> Rectangle<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>\n                    <span class="token punctuation">[</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> relative_start<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> relative_start <span class="token operator">+</span> relative_length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    color<span class="token punctuation">.</span><span class="token function">filled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token punctuation">)</span><span class="token punctuation">;</span>\n                bar<span class="token punctuation">.</span><span class="token function">set_margin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                bar\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to draw series"</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token punctuation">|</span>(x<span class="token punctuation">,</span> y)<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n                PathElement<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">vec!</span><span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span><span class="token function">stroke_width</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>summary<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>',
fields:{tagSlugs:["/tags/rust/"]},frontmatter:{title:"Plotting stacked bar charts in Rust",tags:["Rust"],date:"2022-05-03T23:00:00.000Z",description:"Using Plotters, a Rust-based data plotting library, to generate bar charts."}}},pathContext:{slug:"/posts/plotting-stacked-bar-charts-in-rust"}}}});
//# sourceMappingURL=path---posts-plotting-stacked-bar-charts-in-rust-c4603d8c478dea1c96c2.js.map