<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-jsx-165db493db955fad4499.js" as="script"/><link rel="preload" href="/component---src-templates-post-template-jsx-d7589e304c7c1cd853c9.js" as="script"/><link rel="preload" href="/path---posts-here-be-dragons-string-concatenation-b7dab888fa1b46caff75.js" as="script"/><link rel="preload" href="/app-2dd01fdf1482139d3baa.js" as="script"/><link rel="preload" href="/commons-b3e7f0b7ae63a8e11a1f.js" as="script"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Here be dragons: string concatenation - To kill a mocking bug</title><meta data-react-helmet="true" name="description" content="String concatenation can be done in several ways, each with their own advantages and usecases. In this blogpost I will take a closer look at 4 different ways of concatenating strings and how these are implemented internally. At the end of this post I hope I will have made clear when they are useful, when they are not and how they compare to eachother implementation-wise."/><style id="gatsby-inlined-css">/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100}body{color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(99.9% * 7/12 - 0.78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(99.9% * 2/3 - 0.625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:#222}.tags__list-item-link:focus,.tags__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.categories__list-item-link{color:#222}.categories__list-item-link:focus,.categories__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;margin:1.625rem auto 0;font-weight:600;text-align:center;line-height:2.68125rem}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body :not(div){max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;margin:1.625rem .9375rem 3.25rem;line-height:1.625rem}.post-single__footer-text a{text-decoration:underline}.post-single__date{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.post-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__home-button:focus,.post-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}.menu{margin-bottom:1.625rem}.menu__list{list-style:none;padding:0;margin:0}.menu__list-item{padding:0;margin:.625rem 0}.menu__list-item-link{font-size:1rem;color:#222;font-weight:400;border:0}.menu__list-item-link:focus,.menu__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.menu__list-item-link--active{color:#222;border-bottom:1px solid #222}.links{margin-bottom:1.625rem}.links__list{display:-ms-flexbox;display:flex;list-style:none;padding:0;margin:.625rem -.1875rem}.links__list-item{padding:0;margin:0 .1875rem;height:24px;width:1.5rem;line-height:1.5rem;border-radius:.1875rem;text-align:center;background:#ebebeb}.links__list-item a{border:0}.links__list-item a i{font-size:.875rem;color:#555}.links__list-item a:focus i,.links__list-item a:hover i{color:#222}@font-face{font-family:fontello;src:url(/static/fontello.96eee913.eot);src:url(/static/fontello.96eee913.eot#iefix) format("embedded-opentype"),url(/static/fontello.07ad3c83.woff2) format("woff2"),url(/static/fontello.9aee3ebc.woff) format("woff"),url(/static/fontello.554de365.ttf) format("truetype"),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxtZXRhZGF0YT5Db3B5cmlnaHQgKEMpIDIwMTcgYnkgb3JpZ2luYWwgYXV0aG9ycyBAIGZvbnRlbGxvLmNvbTwvbWV0YWRhdGE+DQo8ZGVmcz4NCjxmb250IGlkPSJmb250ZWxsbyIgaG9yaXotYWR2LXg9IjEwMDAiID4NCjxmb250LWZhY2UgZm9udC1mYW1pbHk9ImZvbnRlbGxvIiBmb250LXdlaWdodD0iNDAwIiBmb250LXN0cmV0Y2g9Im5vcm1hbCIgdW5pdHMtcGVyLWVtPSIxMDAwIiBhc2NlbnQ9Ijg1MCIgZGVzY2VudD0iLTE1MCIgLz4NCjxtaXNzaW5nLWdseXBoIGhvcml6LWFkdi14PSIxMDAwIiAvPg0KPGdseXBoIGdseXBoLW5hbWU9Im1haWwiIHVuaWNvZGU9IiYjeGU4MDA7IiBkPSJNOTI5IDExdjQyOHEtMTgtMjAtMzktMzYtMTQ5LTExNS0yMzgtMTg5LTI4LTI0LTQ2LTM3dC00OC0yOC01Ny0xM2gtMnEtMjYgMC01NyAxM3QtNDggMjgtNDYgMzdxLTg4IDc0LTIzOCAxODktMjEgMTYtMzkgMzZ2LTQyOHEwLTcgNi0xM3QxMi01aDgyMnE3IDAgMTIgNXQ2IDEzeiBtMCA1ODZ2MTR0LTEgNy0xIDctMyA1LTUgNC04IDJoLTgyMnEtNyAwLTEyLTZ0LTYtMTJxMC05NCA4My0xNTkgMTA3LTg0IDIyMy0xNzYgNC0zIDIwLTE3dDI1LTIxIDI1LTE3IDI4LTE2IDI0LTVoMnExMSAwIDI0IDV0MjggMTYgMjUgMTcgMjUgMjEgMjAgMTdxMTE2IDkyIDIyNCAxNzYgMzAgMjQgNTYgNjV0MjYgNzN6IG03MSAyMXYtNjA3cTAtMzctMjYtNjN0LTYzLTI3aC04MjJxLTM2IDAtNjMgMjd0LTI2IDYzdjYwN3EwIDM3IDI2IDYzdDYzIDI2aDgyMnEzNyAwIDYzLTI2dDI2LTYzeiIgaG9yaXotYWR2LXg9IjEwMDAiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJ0d2l0dGVyIiB1bmljb2RlPSImI3hmMDk5OyIgZD0iTTkwNCA2MjJxLTM3LTU0LTkwLTkzIDAtOCAwLTIzIDAtNzMtMjEtMTQ1dC02NC0xMzktMTAzLTExNy0xNDQtODItMTgxLTMwcS0xNTEgMC0yNzYgODEgMTktMiA0My0yIDEyNiAwIDIyNCA3Ny01OSAxLTEwNSAzNnQtNjQgODlxMTktMyAzNC0zIDI0IDAgNDggNi02MyAxMy0xMDQgNjJ0LTQxIDExNXYycTM4LTIxIDgyLTIzLTM3IDI1LTU5IDY0dC0yMiA4NnEwIDQ5IDI1IDkxIDY4LTgzIDE2NC0xMzN0MjA4LTU1cS01IDIxLTUgNDEgMCA3NSA1MyAxMjd0MTI3IDUzcTc5IDAgMTMyLTU3IDYxIDEyIDExNSA0NC0yMS02NC04MC0xMDAgNTIgNiAxMDQgMjh6IiBob3Jpei1hZHYteD0iOTI4LjYiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJmYWNlYm9vayIgdW5pY29kZT0iJiN4ZjA5YTsiIGQ9Ik01MzUgODQzdi0xNDdoLTg3cS00OCAwLTY1LTIwdC0xNy02MHYtMTA2aDE2NGwtMjItMTY1aC0xNDJ2LTQyNGgtMTcxdjQyNGgtMTQydjE2NWgxNDJ2MTIycTAgMTA0IDU4IDE2MXQxNTUgNTdxODIgMCAxMjctN3oiIGhvcml6LWFkdi14PSI1NzEuNCIgLz4NCg0KPGdseXBoIGdseXBoLW5hbWU9InJzcyIgdW5pY29kZT0iJiN4ZjA5ZTsiIGQ9Ik0yMTQgMTAwcTAtNDUtMzEtNzZ0LTc2LTMxLTc2IDMxLTMxIDc2IDMxIDc2IDc2IDMxIDc2LTMxIDMxLTc2eiBtMjg2LTY5cTEtMTUtOS0yNi0xMC0xMi0yNy0xMmgtNzVxLTE0IDAtMjQgOXQtMTEgMjNxLTEyIDEyOC0xMDMgMjE5dC0yMTkgMTAzcS0xNCAxLTIzIDExdC05IDI0djc1cTAgMTYgMTIgMjYgOSAxMCAyNCAxMGgzcTg5LTcgMTcwLTQ1dDE0NS0xMDFxNjMtNjMgMTAxLTE0NXQ0NS0xNzF6IG0yODYtMXExLTE1LTEwLTI2LTEwLTExLTI2LTExaC04MHEtMTQgMC0yNSAxMHQtMTAgMjNxLTcgMTIwLTU3IDIyOHQtMTI5IDE4OC0xODggMTI5LTIyNyA1N3EtMTQgMS0yNCAxMXQtMTAgMjR2ODBxMCAxNiAxMSAyNiAxMCAxMCAyNSAxMGgxcTE0Ny04IDI4MC02N3QyMzgtMTY0cTEwNC0xMDQgMTY0LTIzOHQ2Ny0yODB6IiBob3Jpei1hZHYteD0iNzg1LjciIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJsaW5rZWRpbiIgdW5pY29kZT0iJiN4ZjBlMTsiIGQ9Ik0xOTUgNTAxdi01NTNoLTE4NHY1NTNoMTg0eiBtMTIgMTcxcTAtNDEtMjktNjh0LTc1LTI3aC0xcS00NiAwLTc0IDI3dC0yOCA2OHEwIDQxIDI5IDY4dDc1IDI3IDc0LTI3IDI5LTY4eiBtNjUwLTQwN3YtMzE3aC0xODN2Mjk2cTAgNTktMjMgOTJ0LTcxIDMzcS0zNSAwLTU4LTE5dC0zNi00OHEtNi0xNy02LTQ1di0zMDloLTE4NHExIDIyMyAxIDM2MXQwIDE2NWwtMSAyN2gxODR2LTgwaC0xcTExIDE4IDIzIDMxdDMxIDI5IDQ5IDI0IDY0IDlxOTUgMCAxNTMtNjN0NTgtMTg2eiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPg0KDQo8Z2x5cGggZ2x5cGgtbmFtZT0iZ2l0aHViIiB1bmljb2RlPSImI3hmMTEzOyIgZD0iTTM1NyAxNzFxMC0yMi03LTQ1dC0yNC00My00MC0xOS00MSAxOS0yNCA0My03IDQ1IDcgNDYgMjQgNDMgNDEgMTkgNDAtMTkgMjQtNDMgNy00NnogbTM1NyAwcTAtMjItNy00NXQtMjQtNDMtNDAtMTktNDEgMTktMjQgNDMtNyA0NSA3IDQ2IDI0IDQzIDQxIDE5IDQwLTE5IDI0LTQzIDctNDZ6IG05MCAwcTAgNjctMzkgMTE0dC0xMDQgNDdxLTIzIDAtMTA5LTEyLTQwLTYtODgtNnQtODcgNnEtODUgMTItMTA5IDEyLTY2IDAtMTA0LTQ3dC0zOS0xMTRxMC00OSAxOC04NXQ0NS01OCA2OC0zMyA3OC0xNyA4My00aDk0cTQ2IDAgODMgNHQ3OCAxNyA2OSAzMyA0NSA1OCAxOCA4NXogbTEyNSA5OXEwLTExNi0zNC0xODUtMjItNDMtNTktNzR0LTc5LTQ4LTk1LTI3LTk2LTEyLTkzLTNxLTQzIDAtNzkgMnQtODIgNy04NSAxNy03NyAyOS02NyA0NS00OCA2NHEtMzUgNjktMzUgMTg1IDAgMTMyIDc2IDIyMS0xNSA0NS0xNSA5NSAwIDY0IDI4IDEyMSA2MSAwIDEwNi0yMnQxMDYtNjlxODIgMjAgMTcyIDIwIDgzIDAgMTU3LTE4IDU4IDQ2IDEwNCA2N3QxMDUgMjJxMjktNTcgMjktMTIxIDAtNDktMTUtOTQgNzYtODkgNzYtMjIyeiIgaG9yaXotYWR2LXg9IjkyOC42IiAvPg0KDQo8Z2x5cGggZ2x5cGgtbmFtZT0ic3RhY2tvdmVyZmxvdyIgdW5pY29kZT0iJiN4ZjE2YzsiIGQ9Ik03MTktNjFoLTYyNHYyNjhoLTg5di0zNTdoODAzdjM1N2gtOTB2LTI2OHogbS01MjUgMjkzbDE4IDg3IDQzNy05Mi0xOC04N3ogbTU3IDIwOGwzOCA4MiA0MDQtMTg5LTM3LTgxeiBtMTEyIDE5OWw1NyA2OSAzNDMtMjg3LTU3LTY4eiBtMjIyIDIxMWwyNjYtMzU4LTcxLTUzLTI2NyAzNTd6IG0tNDAxLTgyMXY4OWg0NDd2LTg5aC00NDd6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJpbnN0YWdyYW0iIHVuaWNvZGU9IiYjeGYxNmQ7IiBkPSJNNTcxIDM1MHEwIDU5LTQxIDEwMXQtMTAxIDQyLTEwMS00Mi00Mi0xMDEgNDItMTAxIDEwMS00MiAxMDEgNDIgNDEgMTAxeiBtNzcgMHEwLTkxLTY0LTE1NnQtMTU1LTY0LTE1NiA2NC02NCAxNTYgNjQgMTU2IDE1NiA2NCAxNTUtNjQgNjQtMTU2eiBtNjEgMjI5cTAtMjEtMTUtMzZ0LTM3LTE1LTM2IDE1LTE1IDM2IDE1IDM2IDM2IDE1IDM3LTE1IDE1LTM2eiBtLTI4MCAxMjNxLTQgMC00MyAwdC01OSAwLTU0LTItNTctNS00MC0xMXEtMjgtMTEtNDktMzJ0LTMzLTQ5cS02LTE2LTEwLTQwdC02LTU4LTEtNTMgMC01OSAwLTQzIDAtNDMgMC01OSAxLTUzIDYtNTggMTAtNDBxMTItMjggMzMtNDl0NDktMzJxMTYtNiA0MC0xMXQ1Ny01IDU0LTIgNTkgMCA0MyAwIDQyIDAgNTkgMCA1NCAyIDU4IDUgMzkgMTFxMjggMTEgNTAgMzJ0MzIgNDlxNiAxNiAxMCA0MHQ2IDU4IDEgNTMgMCA1OSAwIDQzIDAgNDMgMCA1OS0xIDUzLTYgNTgtMTAgNDBxLTExIDI4LTMyIDQ5dC01MCAzMnEtMTYgNi0zOSAxMXQtNTggNS01NCAyLTU5IDAtNDIgMHogbTQyOC0zNTJxMC0xMjgtMy0xNzctNS0xMTYtNjktMTgwdC0xNzktNjlxLTUwLTMtMTc3LTN0LTE3NyAzcS0xMTYgNi0xODAgNjl0LTY5IDE4MHEtMyA0OS0zIDE3N3QzIDE3N3E1IDExNiA2OSAxODB0MTgwIDY5cTQ5IDMgMTc3IDN0MTc3LTNxMTE2LTYgMTc5LTY5dDY5LTE4MHEzLTQ5IDMtMTc3eiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPg0KDQo8Z2x5cGggZ2x5cGgtbmFtZT0idHVtYmxyIiB1bmljb2RlPSImI3hmMTczOyIgZD0iTTUyNyAxMDhsNDQtMTMycS0xMi0xOS02MS0zN3QtOTktMThxLTU4LTEtMTA3IDE1dC03OSA0MS01MyA1OS0zMSA2Ny05IDY2djMwNGgtOTR2MTIwcTQwIDE0IDcyIDM5dDUxIDUwIDMyIDU3IDE5IDU1IDggNDlxMSAzIDMgNXQ0IDJoMTM2di0yMzdoMTg2di0xNDBoLTE4NnYtMjg5cTAtMTcgMy0zMXQxMy0zMCAyOC0yMyA0NS04cTQ0IDEgNzUgMTZ6IiBob3Jpei1hZHYteD0iNTcxLjQiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJkcmliYmJsZSIgdW5pY29kZT0iJiN4ZjE3ZDsiIGQ9Ik01NzEgMTNxLTIzIDEzNC03OCAyNzhoLTFsLTEtMXEtOS0zLTI0LTl0LTU2LTI3LTc3LTQ2LTczLTY0LTU3LTgybC05IDZxMTAzLTg0IDIzNC04NCA3MyAwIDE0MiAyOXogbS0xMDMgMzM5cS0xMSAyNy0yOSA2Mi0xNzQtNTItMzc2LTUyIDAtNCAwLTEyIDAtNjkgMjQtMTMydDY5LTExMnEyOCA0OSA2OSA5M3Q4MCA2OSA3MyA0NSA1NSAyN2wyMSA3cTIgMSA3IDJ0NyAzeiBtLTU5IDExOHEtNjcgMTE5LTEzNyAyMTEtNzctMzYtMTMwLTEwNHQtNzItMTUycTE2OSAwIDMzOSA0NXogbTM4MS0xNzhxLTExNyAzMy0yMjggMTYgNDktMTMzIDcxLTI2MiA2MiA0MiAxMDQgMTA2dDUzIDE0MHogbS00NDkgNDE0cS0xIDAtMS0xIDAgMSAxIDF6IG0zMjktODFxLTEwMyA5MS0yNDEgOTEtNDMgMC04Ny0xMCA3My05NSAxMzctMjE0IDM5IDE1IDczIDM0dDU0IDM0IDM2IDMyIDIxIDIzeiBtMTI1LTI3MXEtMiAxMjktODMgMjI5bC0xLTFxLTUtNy0xMS0xM3QtMjQtMjUtNDAtMzQtNTUtMzYtNzQtMzZxMTQtMzAgMjUtNTMgMS0zIDMtMTB0NS05cTIwIDIgNDEgNHQ0MSAxIDM5LTEgMzUtMiAzMi0zIDI3LTQgMjAtMyAxNC0zeiBtNjItNHEwLTExNy01Ny0yMTV0LTE1Ni0xNTYtMjE1LTU4LTIxNiA1OC0xNTUgMTU2LTU4IDIxNSA1OCAyMTUgMTU1IDE1NiAyMTYgNTggMjE1LTU4IDE1Ni0xNTYgNTctMjE1eiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPg0KDQo8Z2x5cGggZ2x5cGgtbmFtZT0ic2t5cGUiIHVuaWNvZGU9IiYjeGYxN2U7IiBkPSJNNjU1IDI1N3EwIDI4LTExIDUxdC0yNyAzOC00MSAyNy00NiAxOS00OSAxM2wtNTggMTRxLTE3IDQtMjUgNnQtMTkgNi0xNyA5LTkgMTItNCAxNnEwIDQzIDgwIDQzIDI0IDAgNDMtNnQzMC0xNiAyMS0xOSAyMy0xNiAyNy03cTI2IDAgNDIgMTh0MTYgNDNxMCAzMS0zMiA1NXQtNzkgMzgtMTAxIDEzcS0zOCAwLTc0LTl0LTY3LTI2LTQ5LTQ4LTE5LTcycTAtMzQgMTAtNjB0MzItNDIgNDQtMjcgNTgtMThsODEtMjBxNTEtMTIgNjMtMjAgMTgtMTEgMTgtMzQgMC0yMS0yMy0zNnQtNTgtMTRxLTI5IDAtNTEgOXQtMzcgMjItMjUgMjUtMjYgMjEtMzAgOXEtMjggMC00Mi0xN3QtMTQtNDFxMC01MiA2OC04OHQxNjItMzdxNDEgMCA3OCAxMHQ2OSAzMCA0OSA1MiAxOSA3NHogbTIwMi0xMjFxMC04OS02My0xNTJ0LTE1MS02M3EtNzMgMC0xMzEgNDUtNDMtOS04My05LTgwIDAtMTUzIDMxdC0xMjYgODQtODMgMTI1LTMxIDE1M3EwIDQxIDkgODQtNDUgNTgtNDUgMTMwIDAgODkgNjMgMTUydDE1MSA2M3E3MyAwIDEzMS00NSA0MyA5IDg0IDkgNzkgMCAxNTItMzF0MTI2LTg0IDg0LTEyNSAzMC0xNTNxMC00MS04LTg0IDQ0LTU4IDQ0LTEzMHoiIGhvcml6LWFkdi14PSI4NTcuMSIgLz4NCg0KPGdseXBoIGdseXBoLW5hbWU9InZrb250YWt0ZSIgdW5pY29kZT0iJiN4ZjE4OTsiIGQ9Ik0xMDcwIDU2MHExMy0zNi04NC0xNjQtMTMtMTgtMzYtNDgtMjItMjgtMzEtNDB0LTE3LTI3LTctMjQgOC0xOSAxOC0yNCAzMi0zMHEyLTEgMi0yIDc5LTczIDEwNy0xMjMgMi0zIDQtN3Q0LTE1LTEtMTktMTQtMTUtMzMtN2wtMTQyLTNxLTE0LTItMzIgM3QtMjkgMTNsLTExIDZxLTE3IDEyLTM5IDM2dC0zOCA0My0zNCAzMy0zMiA4cS0xIDAtNC0ydC0xMC04LTEyLTE2LTktMjktNC00NHEwLTgtMi0xNXQtNC0xMGwtMi0zcS0xMC0xMS0zMC0xMmgtNjRxLTQwLTMtODEgOXQtNzQgMjktNTcgMzctNDAgMzJsLTE0IDE0cS01IDUtMTUgMTd0LTQwIDUwLTU5IDg1LTY4IDExNy03MyAxNTJxLTQgOS00IDE1dDIgOWwyIDNxOSAxMSAzMiAxMWwxNTMgMXE3LTEgMTMtM3Q5LTVsMy0ycTktNiAxMy0xOCAxMS0yOCAyNi01N3QyMy00Nmw5LTE2cTE2LTM0IDMxLTU4dDI3LTM4IDIzLTIyIDE5LTggMTUgM3ExIDEgMyAzdDcgMTIgNyAyNiA1IDQ2IDAgNjlxLTEgMjMtNSA0MXQtNyAyNmwtNCA2cS0xNCAxOS00NyAyNC04IDIgMyAxNCA4IDEwIDIxIDE3IDI5IDE0IDEzMyAxMyA0Ni0xIDc1LTcgMTItMyAxOS04dDEyLTEzIDUtMTggMi0yNSAwLTMxLTItNDAgMC00NnEwLTYtMS0yM3QwLTI3IDItMjIgNi0yMiAxMy0xNHE0LTEgOS0ydDE1IDYgMjEgMTkgMjkgMzggMzggNjBxMzMgNTggNjAgMTI1IDIgNiA1IDEwdDYgNmwzIDIgMiAxdDggMiAxMSAwbDE2MCAxcTIyIDMgMzYtMXQxNy0xMHoiIGhvcml6LWFkdi14PSIxMDcxLjQiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJzbGFjayIgdW5pY29kZT0iJiN4ZjE5ODsiIGQ9Ik04NDggNDE3cTM0IDAgNTctMjN0MjQtNTZxMC01NC01Mi03M2wtOTYtMzMgMzEtOTNxNC0xMiA0LTI2IDAtMzMtMjQtNTd0LTU2LTI0cS0yNiAwLTQ4IDE1dC0yOSA0MGwtMzEgOTItMTczLTU5IDMxLTkxcTQtMTQgNC0yNyAwLTMzLTIzLTU3dC01Ny0yNHEtMjcgMC00OCAxNXQtMjkgNDFsLTMxIDkxLTg1LTMwcS0xNy01LTI4LTUtMzQgMC01NyAyMnQtMjMgNTdxMCAyNiAxNiA0N3Q0MCAzMGw4NyAyOS01OSAxNzUtODctMzBxLTE0LTUtMjctNS0zMyAwLTU2IDIzdC0yMyA1NnEwIDI2IDE1IDQ4dDQwIDI5bDg4IDMwLTMwIDg4cS00IDE0LTQgMjcgMCAzMyAyMyA1N3Q1NyAyNHEyNiAwIDQ4LTE2dDI5LTQwbDMwLTg5IDE3MyA1OS0zMCA4OXEtNCAxMy00IDI2IDAgMzMgMjMgNTd0NTcgMjRxMjYgMCA0OC0xNXQzMC00MGwyOS05MCA5MSAzMXExMSAzIDI0IDMgMzMgMCA1Ny0yMnQyNC01NXEwLTI1LTE3LTQ1dC00MS0yOWwtODgtMzAgNTktMTc3IDkxIDMycTEzIDQgMjYgNHogbS00NDMtMTQ2bDE3MyA1OC01OSAxNzYtMTczLTYweiIgaG9yaXotYWR2LXg9IjkyOC42IiAvPg0KDQo8Z2x5cGggZ2x5cGgtbmFtZT0icGFwZXItcGxhbmUiIHVuaWNvZGU9IiYjeGYxZDg7IiBkPSJNOTg0IDg0NHExOS0xMyAxNS0zNmwtMTQyLTg1N3EtMy0xNi0xOC0yNS04LTUtMTgtNS02IDAtMTMgM2wtMjUzIDEwNC0xMzUtMTY1cS0xMC0xMy0yNy0xMy03IDAtMTIgMi0xMSA0LTE3IDEzdC03IDIxdjE5NWw0ODIgNTkwLTU5Ni01MTYtMjIxIDkxcS0yMCA4LTIyIDMwLTEgMjMgMTggMzNsOTI4IDUzNnE5IDUgMTggNSAxMSAwIDIwLTZ6IiBob3Jpei1hZHYteD0iMTAwMCIgLz4NCg0KPGdseXBoIGdseXBoLW5hbWU9IndoYXRzYXBwIiB1bmljb2RlPSImI3hmMjMyOyIgZD0iTTU1MCAzMDdxNyAwIDU0LTI1dDUwLTMwcTEtMiAxLTggMC0xOC05LTQyLTktMjItNDAtMzd0LTU3LTE1cS0zMiAwLTEwNiAzNS01NSAyNS05NSA2NnQtODIgMTAzcS00MSA2MC00MCAxMDh2NXEyIDUwIDQxIDg4IDE0IDEyIDI5IDEyIDQgMCAxMC0xdDExLTFxMTEgMCAxNS0zdDgtMTZxNS0xMSAxOS00OXQxNC00MXEwLTEyLTE5LTMzdC0yMC0yNnEwLTMgMy04IDE5LTQxIDU3LTc2IDMxLTMwIDg0LTU3IDctNCAxMy00IDggMCAzMCAyN3QyOSAyOHogbS0xMTQtMjk2cTcxIDAgMTM2IDI4dDExMiA3NCA3NSAxMTIgMjggMTM2LTI4IDEzNi03NSAxMTItMTEyIDc1LTEzNiAyOC0xMzUtMjgtMTEyLTc1LTc1LTExMi0yOC0xMzZxMC0xMTMgNjctMjA1bC00NC0xMzAgMTM1IDQzcTg4LTU4IDE5Mi01OHogbTAgNzcxcTg2IDAgMTY0LTM0dDEzNC04OSA5MC0xMzUgMzMtMTYzLTMzLTE2My05MC0xMzQtMTM0LTkwLTE2NC0zNHEtMTA4IDAtMjAzIDUzbC0yMzMtNzUgNzYgMjI2cS02MCA5OS02MCAyMTcgMCA4NiAzMyAxNjN0OTAgMTM1IDEzNCA4OSAxNjMgMzR6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+DQoNCjxnbHlwaCBnbHlwaC1uYW1lPSJvZG5va2xhc3NuaWtpIiB1bmljb2RlPSImI3hmMjYzOyIgZD0iTTM1NyAzNDRxLTEwNSAwLTE3OSA3NHQtNzQgMTc5cTAgMTA1IDc0IDE3OXQxNzkgNzQgMTc5LTc0IDc1LTE3OXEwLTEwNS03NS0xNzl0LTE3OS03NHogbTAgMzc4cS01MSAwLTg4LTM3dC0zNi04OHEwLTUyIDM2LTg4dDg4LTM3IDg4IDM3IDM3IDg4cTAgNTItMzcgODh0LTg4IDM3eiBtMjkyLTQwOXE3LTE1IDgtMjd0LTItMjMtMTUtMjEtMjQtMjEtMzQtMjNxLTY0LTQxLTE3Ni01M2w0MS00MCAxNDktMTQ5cTE3LTE3IDE3LTQxdC0xNy00MWwtNy03cS0xNy0xNy00MS0xN3QtNDEgMTdxLTM4IDM4LTE0OSAxNDlsLTE0OS0xNDlxLTE4LTE3LTQyLTE3dC00MCAxN2wtNyA3cS0xNyAxNy0xNyA0MXQxNyA0MWwxNDkgMTQ5IDQwIDQwcS0xMTMgMTItMTc3IDUzLTIxIDE0LTM0IDIzdC0yNCAyMS0xNSAyMS0yIDIzIDggMjdxNiAxMSAxNiAyMHQyMyAxMiAzMi0xIDM2LTIwcTMtMiA4LTZ0MjQtMTMgMzktMTcgNTEtMTQgNjMtNnE1MSAwIDk3IDE0dDY3IDI4bDIxIDE0cTE5IDE1IDM3IDIwdDMxIDEgMjMtMTIgMTYtMjB6IiBob3Jpei1hZHYteD0iNzE0LjMiIC8+DQo8L2ZvbnQ+DQo8L2RlZnM+DQo8L3N2Zz4=#fontello) format("svg");font-weight:400;font-style:normal}[class*=" icon-"]:before,[class^=icon-]:before{font-family:fontello;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-mail:before{content:"\E800"}.icon-twitter:before{content:"\F099"}.icon-facebook:before{content:"\F09A"}.icon-rss:before{content:"\F09E"}.icon-linkedin:before{content:"\F0E1"}.icon-github:before{content:"\F113"}.icon-stackoverflow:before{content:"\F16C"}.icon-instagram:before{content:"\F16D"}.icon-tumblr:before{content:"\F173"}.icon-dribbble:before{content:"\F17D"}.icon-skype:before{content:"\F17E"}.icon-vkontakte:before{content:"\F189"}.icon-slack:before{content:"\F198"}.icon-paper-plane:before{content:"\F1D8"}.icon-whatsapp:before{content:"\F232"}.icon-odnoklassniki:before{content:"\F263"}.sidebar{width:100%}.sidebar__inner{position:relative;padding:1.5625rem 1.25rem 0}.sidebar__author-photo{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.sidebar__author-title{font-size:1.125rem;font-weight:500;line-height:1.82813rem;margin:.8125rem 0}.sidebar__author-title-link,.sidebar__author-title-link:focus,.sidebar__author-title-link:hover{color:#222}.sidebar__author-subtitle{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.sidebar__copyright{color:#b6b6b6;font-size:.875rem}@media screen and (min-width:685px){.sidebar{width:calc(99.9% * 5/12 - 1.09375rem)}.sidebar:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.sidebar:last-child{margin-right:0}.sidebar:nth-child(12n){margin-right:0;float:right}.sidebar:nth-child(12n+1){clear:both}.sidebar__inner{padding:1.875rem 1.25rem 0}.sidebar__inner:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:540px;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.sidebar{width:calc(99.9% * 1/3 - 1.25rem)}.sidebar:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.sidebar:last-child{margin-right:0}.sidebar:nth-child(3n){margin-right:0;float:right}.sidebar:nth-child(3n+1){clear:both}.sidebar__inner{padding:2.5rem}}.post{margin-bottom:2.03125rem}.post:last-child,.post__title{margin-bottom:.8125rem}.post__title{font-size:1.6875rem;line-height:2.4375rem;margin-top:0}.post__title-link{color:#222}.post__title-link:focus,.post__title-link:hover{color:#222;border-bottom:1px solid #222}.post__description{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.post__meta-time{font-size:.875rem;color:#222;font-weight:500;text-transform:uppercase}.post__meta-divider{margin:0 .3125rem}.post__meta-category-link{font-size:.875rem;color:#f7a046;font-weight:500;text-transform:uppercase}.post__meta-category-link:focus,.post__meta-category-link:hover{color:#5d93ff}.post__readmore{font-size:1rem;color:#5d93ff}.post__readmore:focus,.post__readmore:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.page{margin-bottom:3.25rem}.page__title{font-size:2.5rem;font-weight:500;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.page__body{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}</style></head><body><div id="___gatsby"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="1163223307"><!-- react-empty: 2 --><div data-reactid="3"><!-- react-empty: 4 --><div data-reactid="5"><div data-reactid="6"><a class="post-single__home-button" href="/" data-reactid="7">All Articles</a></div><div class="post-single" data-reactid="8"><div class="post-single__inner" data-reactid="9"><h1 class="post-single__title" data-reactid="10">Here be dragons: string concatenation</h1><div class="post-single__body" data-reactid="11"><h1>Introduction</h1>
<p>String concatenation can be done in several ways, each with their own advantages and usecases. In this blogpost I will take a closer look at 4 different ways of concatenating strings and how these are implemented internally. At the end of this post I hope I will have made clear when they are useful, when they are not and how they compare to eachother implementation-wise.</p>
<p>The approaches discussed are:</p>
<ul>
<li>Simple concatenation</li>
<li><code class="language-text">string.Concat()</code></li>
<li><code class="language-text">StringBuilder</code></li>
<li><code class="language-text">string.Join()</code></li>
</ul>
<h1>Simple concatenation</h1>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">string</span> a <span class="token operator">=</span> <span class="token string">"Hello"</span> <span class="token operator">+</span> <span class="token string">"World"</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>String concatenation is commonly done using the <code class="language-text">+</code> operator and passing one or two strings as its operands. Notice that something like <code class="language-text">string a = &quot;abc&quot; + new FileLoadException();</code> is perfectly legal: you’ll see in a bit why this is.</p>
<p>You might have been wondering what happens exactly when you use this form of concatenation. In order to find out, we have to look at the generated IL code. Now, if you simply look at the generated IL given the string above you will notice that it looks like this:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">IL_0000: nop
IL_0001: ldstr &quot;HelloWorld&quot;
IL_0006: stloc.0 // a
IL_0007: ret</code></pre>
      </div>
<p>Because our string concatenation is considered a so-called “compile-time constant expression” the compiler turns it into a single string for us already.</p>
<p>We can bypass this optimization by defining it as two separate variables and concatenating these:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">string</span> x <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> y <span class="token operator">=</span> <span class="token string">"World"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> a <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span></code></pre>
      </div>
<p>Looking at the IL again we now see this:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">IL_0000: nop
IL_0001: ldstr &quot;Hello&quot;
IL_0006: stloc.0 // x
IL_0007: ldstr &quot;World&quot;
IL_000C: stloc.1 // y
IL_000D: ldloc.0 // x
IL_000E: ldloc.1 // y
IL_000F: call System.String.Concat
IL_0014: stloc.2 // a
IL_0015: ret</code></pre>
      </div>
<p>That’s more like it! We can tell from this that first the two strings are loaded into memory (separately!) and, more interestingly, they are put together using the <code class="language-text">string.Concat()</code> method.</p>
<h1>string.Concat()</h1>
<p>We’ve seen now that simple string concatenation results in a call to <code class="language-text">string.Concat()</code>. Depending on the types passed in it will choose between <code class="language-text">string.Concat(string, string)</code> (in the case of two strings) or <code class="language-text">string.Concat(object, object)</code> (in the case of only one string). If you’ll replace the simple concatenation with a call to <code class="language-text">string.Format()</code> you’ll notice that you receive the exact same IL.</p>
<p>At this point we can take a look at the internals and what goes on exactly. Looking at <a href="https://github.com/dotnet/coreclr/blob/d176041723f366c35fd71ee4b176253fefddfee1/src/mscorlib/src/System/String.cs#L3011">the source code</a> of <code class="language-text">string.Concat(object, object)</code> we can see it is a pass-through to <code class="language-text">string.Concat(string, string)</code> by calling <code class="language-text">ToString()</code> on both operands — even if one of these was already a string.</p>
<p><a href="https://github.com/dotnet/coreclr/blob/d176041723f366c35fd71ee4b176253fefddfee1/src/mscorlib/src/System/String.cs#L3141">Our next step</a> is more interesting: after the usual validation handling and fast tracks, we see a few very interesting methods being called:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">FastAllocateString</span><span class="token punctuation">(</span>str0Length <span class="token operator">+</span> str1<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">FillStringChecked</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> str0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">FillStringChecked</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> str0Length<span class="token punctuation">,</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p><code class="language-text">FastAllocateString(int)</code> is an external method that will allocate the space needed to concatenate both strings which is evidently the sum of their lengths. Afterwards, <code class="language-text">FillStringChecked(string, int, string)</code> will copy the contents from the given string (third parameter) at a certain index into the aggregate one we just allocated. At this point the aggregate string is filled and can be returned to the caller. You might have noticed that <code class="language-text">FastAllocateString</code> returns a string and not a <code class="language-text">char</code> array. This is important because it changes the way we have to fill it: with a char array we would be able to simply access each entry directly and insert the correct value. However since it is a string we can (have to?) use an unsafe context and pull out some C to copy the contents into the correct memory location. This has as benefit that you don’t have to loop (explicitly) to move the string around.</p>
<h2>What about more concatenations?</h2>
<p>If you look at the overloads you’ll notice that there are overloads with 2, 3 and 4 parameters and afer that you have to use the one with only one: a collection. We can see this in action when we try to concatenate 5 strings:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">string</span> v <span class="token operator">=</span> <span class="token string">"Strings"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> w <span class="token operator">=</span> <span class="token string">"Are"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> x <span class="token operator">=</span> <span class="token string">"Fun"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> y <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> z <span class="token operator">=</span> <span class="token string">"World"</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> a <span class="token operator">=</span> v <span class="token operator">+</span> w <span class="token operator">+</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span></code></pre>
      </div>
<p>generates as IL:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">IL_0000:  nop
IL_0001:  ldstr       &quot;Strings&quot;
IL_0006:  stloc.0     // v
IL_0007:  ldstr       &quot;Are&quot;
IL_000C:  stloc.1     // w
IL_000D:  ldstr       &quot;Fun&quot;
IL_0012:  stloc.2     // x
IL_0013:  ldstr       &quot;Hello&quot;
IL_0018:  stloc.3     // y
IL_0019:  ldstr       &quot;World&quot;
IL_001E:  stloc.s     04 // z
IL_0020:  ldc.i4.5
IL_0021:  newarr      System.String
IL_0026:  dup
IL_0027:  ldc.i4.0
IL_0028:  ldloc.0     // v
IL_0029:  stelem.ref
IL_002A:  dup
IL_002B:  ldc.i4.1
IL_002C:  ldloc.1     // w
IL_002D:  stelem.ref
IL_002E:  dup
IL_002F:  ldc.i4.2
IL_0030:  ldloc.2     // x
IL_0031:  stelem.ref
IL_0032:  dup
IL_0033:  ldc.i4.3
IL_0034:  ldloc.3     // y
IL_0035:  stelem.ref
IL_0036:  dup
IL_0037:  ldc.i4.4
IL_0038:  ldloc.s     04 // z
IL_003A:  stelem.ref
IL_003B:  call        System.String.Concat
IL_0040:  stloc.s     05 // a
IL_0042:  ret</code></pre>
      </div>
<p>This clearly shows us a new array is created (see instruction <code class="language-text">IL_0021</code>) which is then passed to the <code class="language-text">string.Concat()</code> call.
The reason there are these specific overloads for 3 and 4 arguments is performance: the most common scenarios of concatenating values include 2, 3 or 4 operands and as such these are treated separatedly to get performance gains in the majority of cases.</p>
<p>For this implementation we have to take a look at the <code class="language-text">string.Concat(params string[])</code> method. The implementation here is fairly straightforward: just as in the previous methods we calculate the total length of the resulting string and afterwards fill that up with the <code class="language-text">string.ConcatArray(string[], int)</code> method. Also interesting to notice is the threading consideration by deep-copying the array of strings to a new, local one!</p>
<h1>StringBuilder</h1>
<p>It’s time to add the notorious <code class="language-text">StringBuilder</code> to the mix. We’ll work with a very simple scenario:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sb<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sb<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> a <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>A <code class="language-text">StringBuilder</code> is in essence a wrapper class around an array of chars and each time you append something to it, it inserts the given string’s content (aka: the chars) in the next available space in the <code class="language-text">StringBuilder</code> array. This follows a similar idea to <code class="language-text">string.Concat</code> but the big benefit here is that the resulting array is maintained over multiple calls instead of a single call. You might see where I’m going with this: <code class="language-text">string.Concat()</code> creates a new string object for each call. A <code class="language-text">StringBuilder</code> however only does this when its <code class="language-text">ToString()</code> method is called regardless of how often you call <code class="language-text">StringBuilder.Append()</code>. The more objects you allocate, the more you strain the garbage collector and the sooner you trigger a garbage collection. Nobody likes collecting garbage if it could have been prevented altogether.</p>
<p>The obvious real-life scenario is when you use a loop.</p>
<h1>string.Join()</h1>
<p>Last but not least: <code class="language-text">string.Join()</code>. Admittedly, this probably isn’t the usecase most people have in mind for this method but since it still fits, I thought it to be interesting to include in this overview. When we look at <a href="https://github.com/dotnet/coreclr/blob/d176041723f366c35fd71ee4b176253fefddfee1/src/mscorlib/src/System/String.cs#L156">the code</a> we notice something interesting: it uses a <code class="language-text">StringBuilder</code> internally!</p>
<p>I believe you’ll find this to be a common sight: many methods that have to concatenate strings use a StringBuilder internally.</p>
<h1>Conclusion</h1>
<p>Reflecting on these four approaches we can group them under two actually different ones: <code class="language-text">string.Concat()</code> and <code class="language-text">StringBuilder</code>. We’ve also seen that <code class="language-text">string.Concat()</code> creates a new string each time you concatenate it whereas <code class="language-text">StringBuilder</code> delays this until the very end and only does it once. On the other hand: constructing a <code class="language-text">StringBuilder</code> object, adding to it and then retrieving the result is much more verbose than a simple + operator.</p>
<p>You will have to decide for yourself what you consider acceptable but I personally only use <code class="language-text">StringBuilder</code> when I loop over something. If I can do concatenating “manually” and it remains readable then it must mean there are so little strings that it would barely make a difference anyway (don’t forget that the <code class="language-text">StringBuilder</code> is an object that needs to be allocated as well!).</p></div><div class="post-single__date" data-reactid="12"><em data-reactid="13"><!-- react-text: 14 -->Published <!-- /react-text --><!-- react-text: 15 -->17 Sep 2015<!-- /react-text --></em></div></div><div class="post-single__footer" data-reactid="16"><div class="post-single__tags" data-reactid="17"><ul class="post-single__tags-list" data-reactid="18"><li class="post-single__tags-list-item" data-reactid="19"><a class="post-single__tags-list-item-link" href="/tags/c/" data-reactid="20">C#</a></li><li class="post-single__tags-list-item" data-reactid="21"><a class="post-single__tags-list-item-link" href="/tags/performance/" data-reactid="22">Performance</a></li></ul></div><hr data-reactid="23"/><p class="post-single__footer-text" data-reactid="24"><!-- react-text: 25 -->Unearthing curious .NET behaviour<!-- /react-text --><a href="https://twitter.com/VannevelJeroen" target="_blank" rel="noopener noreferrer" data-reactid="26"><br data-reactid="27"/><!-- react-text: 28 --> <!-- /react-text --><strong data-reactid="29">Jeroen Vannevel</strong><!-- react-text: 30 --> on Twitter<!-- /react-text --></a></p><!-- react-text: 31 --><!-- /react-text --></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-2dd01fdf1482139d3baa.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","108009296967943":"component---src-templates-post-template-jsx-d7589e304c7c1cd853c9.js","2638498282051":"component---src-templates-tag-template-jsx-2b3726fa7cce65b202ed.js","90179704293519":"component---src-templates-category-template-jsx-801615e0ee15486d4622.js","11305920230724":"component---src-templates-page-template-jsx-ef150ef5bc28b140dfe9.js","183328146348521":"component---src-pages-404-jsx-265d0c38bdff4d0a90c6.js","142542727794042":"component---src-pages-categories-jsx-2da18a892adca87ae12e.js","213534597649335":"component---src-pages-index-jsx-64649fde84da96ead11c.js","36530248567819":"component---src-pages-tags-jsx-e787e63a56bf6859a224.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","57414648566179":"path---posts-how-to-configure-a-custom-identityuser-for-entity-framework-4c07589d63d576bf0b2f.js","99965129943657":"path---tags-c-16aa71d0d2ca94322485.js","158948812405505":"path---tags-asp-net-cf2cd5c65ea85fb5dd3e.js","43594519827409":"path---tags-entity-framework-5ab253e82ce305c0e492.js","194347916880816":"path---tags-unit-testing-152cdfa0f2494b47e847.js","163783469962619":"path---categories-testing-01df09dbe47f539a110b.js","10833908716903":"path---posts-hello-linux-9ced8f8192e383732211.js","102626217677571":"path---tags-net-ef6a16d8fb5633f9f1a6.js","115329724643966":"path---tags-linux-a5d73fefa6843171e4dc.js","6486568870292":"path---tags-visual-studio-code-eb782ff10cfba6cff4e0.js","72987173723140":"path---tags-dnx-f08ee9fc051ae3eefc90.js","55906874678431":"path---categories-net-9e127642aa97880ac934.js","210013022422731":"path---posts-what-is-unit-testing-21aefc78c63e0e3033f6.js","154656482558507":"path---posts-introducing-vsdiagnostics-768ca97b8d1103fe7f13.js","186975418890208":"path---tags-roslyn-5a50a77496953d899c78.js","194622622375975":"path---tags-visual-studio-8e58c772dba73ceaee38.js","210199730923038":"path---tags-diagnostics-f4ea87e4072e6e9deca4.js","128504387138817":"path---categories-roslyn-7651cf5d085d7e7aa3ad.js","60123928662786":"path---posts-introducing-roslyntester-a189e72e0ef3c53977de.js","225248144606594":"path---posts-a-few-important-roslyn-api-helpers-d63d457cb4423d8b80c3.js","171537721535774":"path---tags-nu-get-a584a9feee3a0359277b.js","256292793965140":"path---tags-ms-build-46d1335bd2435cf9faaf.js","102038638384165":"path---posts-quick-tip-getting-a-variables-data-during-debugging-85779fea5148f5273225.js","96054509920718":"path---tags-debugging-f29b02ddb243156738fc.js","132891409650980":"path---categories-debugging-5e02c96383935516a4a9.js","32744716682477":"path---posts-launching-your-first-webapp-in-visual-studio-code-through-gulp-3b2a82be3e588c5acdb0.js","177761263186651":"path---tags-gulp-5459d4dc085cd1474731.js","96407400828738":"path---tags-angular-js-abfc3c10691c83730f91.js","102352008175747":"path---categories-web-dev-3c0798fc9d5a9c8351dd.js","33884994942753":"path---posts-generating-a-nuget-package-in-a-localized-directory-on-each-build-a41999682dbe0984ef23.js","244522834873248":"path---categories-ms-build-85c2441e35927d02da3b.js","273950069227526":"path---about-92d2c9486ef3e21549c9.js","184662623972074":"path---contact-74553549f1858316db19.js","257155450825018":"path---posts-unit-testing-web-api-routes-and-parameter-validation-28a3ad01bcc55304f041.js","31221279016344":"path---tags-routing-1824fa0638cac68484ae.js","125786144107852":"path---posts-properly-testing-entity-framework-with-effort-4f552f6c7f49b364f220.js","225042621602343":"path---posts-unit-testing-your-owin-configured-oauth-2-implementation-fb8366811d13c480b0f6.js","31071873732760":"path---tags-dependency-injection-8188a8401b6c044750b2.js","273162457360029":"path---tags-authentication-cf2bd23219b036f33417.js","109586088525438":"path---posts-getting-started-with-your-first-diagnostic-5fca875b077b313c8014.js","267124642010291":"path---posts-here-be-dragons-string-concatenation-b7dab888fa1b46caff75.js","85273878220361":"path---tags-performance-aeed97d5006627949570.js","274987976086560":"path---categories-performance-0e8f9cb87430e5a3692a.js","254022195166212":"path---404-221155fc245697adf7df.js","30875753179511":"path---categories-d7dd0e5f203b7b9a26db.js","142629428675168":"path---index-506b0afec77bc248ac6b.js","55702396619907":"path---tags-d0df61ea991e7ce98e80.js","178698757827068":"path---404-html-221155fc245697adf7df.js","79611799117203":"component---src-layouts-index-jsx-165db493db955fad4499.js"}/*]]>*/</script><script>
            
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-73379983-2', 'auto');
      }
      </script><script>/*<![CDATA[*/["/commons-b3e7f0b7ae63a8e11a1f.js","/app-2dd01fdf1482139d3baa.js","/path---posts-here-be-dragons-string-concatenation-b7dab888fa1b46caff75.js","/component---src-templates-post-template-jsx-d7589e304c7c1cd853c9.js","/component---src-layouts-index-jsx-165db493db955fad4499.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>