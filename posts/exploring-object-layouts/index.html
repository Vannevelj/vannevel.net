<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-jsx-06f008698c6b616768bb.js" as="script"/><link rel="preload" href="/component---src-templates-post-template-jsx-4c1c99dd96b73e8d9acd.js" as="script"/><link rel="preload" href="/path---posts-exploring-object-layouts-e1f1c760dc7df59bbfc5.js" as="script"/><link rel="preload" href="/app-cac8019cf2acad5c70a4.js" as="script"/><link rel="preload" href="/commons-50675cee3a38850a85f7.js" as="script"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Exploring Object Layouts - To kill a mocking bug</title><meta data-react-helmet="true" name="description" content="Removing fields from an object should reduce that object&#x27;s size. Why am I not seeing any difference?"/><style id="gatsby-inlined-css">/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100}body{color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(99.9% * 7/12 - 0.78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(99.9% * 2/3 - 0.625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:#222}.tags__list-item-link:focus,.tags__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.categories__list-item-link{color:#222}.categories__list-item-link:focus,.categories__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.post-single__inner{max-width:71.875rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:52.8125rem;margin:1.625rem auto 0;font-weight:600;text-align:center;line-height:2.68125rem}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:52.8125rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:52.8125rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body :not(div){max-width:52.8125rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:52.8125rem;margin:1.625rem .9375rem 3.25rem;line-height:1.625rem}.post-single__footer-text a{text-decoration:underline}.post-single__date{max-width:52.8125rem;margin-left:auto;margin-right:auto}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.post-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__home-button:focus,.post-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}.menu{margin-bottom:1.625rem}.menu__list{list-style:none;padding:0;margin:0}.menu__list-item{padding:0;margin:.625rem 0}.menu__list-item-link{font-size:1rem;color:#222;font-weight:400;border:0}.menu__list-item-link:focus,.menu__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.menu__list-item-link--active{color:#222;border-bottom:1px solid #222}.links{margin-bottom:1.625rem}.links__list{display:-ms-flexbox;display:flex;list-style:none;padding:0;margin:.625rem -.1875rem}.links__list-item{padding:0;margin:0 .1875rem;height:24px;width:1.5rem;line-height:1.5rem;border-radius:.1875rem;text-align:center;background:#ebebeb}.links__list-item a{border:0}.links__list-item a i{font-size:.875rem;color:#555}.links__list-item a:focus i,.links__list-item a:hover i{color:#222}@font-face{font-family:fontello;src:url(/static/fontello.96eee913.eot);src:url(/static/fontello.96eee913.eot#iefix) format("embedded-opentype"),url(/static/fontello.07ad3c83.woff2) format("woff2"),url(/static/fontello.9aee3ebc.woff) format("woff"),url(/static/fontello.554de365.ttf) format("truetype"),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxtZXRhZGF0YT5Db3B5cmlnaHQgKEMpIDIwMTcgYnkgb3JpZ2luYWwgYXV0aG9ycyBAIGZvbnRlbGxvLmNvbTwvbWV0YWRhdGE+CjxkZWZzPgo8Zm9udCBpZD0iZm9udGVsbG8iIGhvcml6LWFkdi14PSIxMDAwIiA+Cjxmb250LWZhY2UgZm9udC1mYW1pbHk9ImZvbnRlbGxvIiBmb250LXdlaWdodD0iNDAwIiBmb250LXN0cmV0Y2g9Im5vcm1hbCIgdW5pdHMtcGVyLWVtPSIxMDAwIiBhc2NlbnQ9Ijg1MCIgZGVzY2VudD0iLTE1MCIgLz4KPG1pc3NpbmctZ2x5cGggaG9yaXotYWR2LXg9IjEwMDAiIC8+CjxnbHlwaCBnbHlwaC1uYW1lPSJtYWlsIiB1bmljb2RlPSImI3hlODAwOyIgZD0iTTkyOSAxMXY0MjhxLTE4LTIwLTM5LTM2LTE0OS0xMTUtMjM4LTE4OS0yOC0yNC00Ni0zN3QtNDgtMjgtNTctMTNoLTJxLTI2IDAtNTcgMTN0LTQ4IDI4LTQ2IDM3cS04OCA3NC0yMzggMTg5LTIxIDE2LTM5IDM2di00MjhxMC03IDYtMTN0MTItNWg4MjJxNyAwIDEyIDV0NiAxM3ogbTAgNTg2djE0dC0xIDctMSA3LTMgNS01IDQtOCAyaC04MjJxLTcgMC0xMi02dC02LTEycTAtOTQgODMtMTU5IDEwNy04NCAyMjMtMTc2IDQtMyAyMC0xN3QyNS0yMSAyNS0xNyAyOC0xNiAyNC01aDJxMTEgMCAyNCA1dDI4IDE2IDI1IDE3IDI1IDIxIDIwIDE3cTExNiA5MiAyMjQgMTc2IDMwIDI0IDU2IDY1dDI2IDczeiBtNzEgMjF2LTYwN3EwLTM3LTI2LTYzdC02My0yN2gtODIycS0zNiAwLTYzIDI3dC0yNiA2M3Y2MDdxMCAzNyAyNiA2M3Q2MyAyNmg4MjJxMzcgMCA2My0yNnQyNi02M3oiIGhvcml6LWFkdi14PSIxMDAwIiAvPgoKPGdseXBoIGdseXBoLW5hbWU9InR3aXR0ZXIiIHVuaWNvZGU9IiYjeGYwOTk7IiBkPSJNOTA0IDYyMnEtMzctNTQtOTAtOTMgMC04IDAtMjMgMC03My0yMS0xNDV0LTY0LTEzOS0xMDMtMTE3LTE0NC04Mi0xODEtMzBxLTE1MSAwLTI3NiA4MSAxOS0yIDQzLTIgMTI2IDAgMjI0IDc3LTU5IDEtMTA1IDM2dC02NCA4OXExOS0zIDM0LTMgMjQgMCA0OCA2LTYzIDEzLTEwNCA2MnQtNDEgMTE1djJxMzgtMjEgODItMjMtMzcgMjUtNTkgNjR0LTIyIDg2cTAgNDkgMjUgOTEgNjgtODMgMTY0LTEzM3QyMDgtNTVxLTUgMjEtNSA0MSAwIDc1IDUzIDEyN3QxMjcgNTNxNzkgMCAxMzItNTcgNjEgMTIgMTE1IDQ0LTIxLTY0LTgwLTEwMCA1MiA2IDEwNCAyOHoiIGhvcml6LWFkdi14PSI5MjguNiIgLz4KCjxnbHlwaCBnbHlwaC1uYW1lPSJmYWNlYm9vayIgdW5pY29kZT0iJiN4ZjA5YTsiIGQ9Ik01MzUgODQzdi0xNDdoLTg3cS00OCAwLTY1LTIwdC0xNy02MHYtMTA2aDE2NGwtMjItMTY1aC0xNDJ2LTQyNGgtMTcxdjQyNGgtMTQydjE2NWgxNDJ2MTIycTAgMTA0IDU4IDE2MXQxNTUgNTdxODIgMCAxMjctN3oiIGhvcml6LWFkdi14PSI1NzEuNCIgLz4KCjxnbHlwaCBnbHlwaC1uYW1lPSJyc3MiIHVuaWNvZGU9IiYjeGYwOWU7IiBkPSJNMjE0IDEwMHEwLTQ1LTMxLTc2dC03Ni0zMS03NiAzMS0zMSA3NiAzMSA3NiA3NiAzMSA3Ni0zMSAzMS03NnogbTI4Ni02OXExLTE1LTktMjYtMTAtMTItMjctMTJoLTc1cS0xNCAwLTI0IDl0LTExIDIzcS0xMiAxMjgtMTAzIDIxOXQtMjE5IDEwM3EtMTQgMS0yMyAxMXQtOSAyNHY3NXEwIDE2IDEyIDI2IDkgMTAgMjQgMTBoM3E4OS03IDE3MC00NXQxNDUtMTAxcTYzLTYzIDEwMS0xNDV0NDUtMTcxeiBtMjg2LTFxMS0xNS0xMC0yNi0xMC0xMS0yNi0xMWgtODBxLTE0IDAtMjUgMTB0LTEwIDIzcS03IDEyMC01NyAyMjh0LTEyOSAxODgtMTg4IDEyOS0yMjcgNTdxLTE0IDEtMjQgMTF0LTEwIDI0djgwcTAgMTYgMTEgMjYgMTAgMTAgMjUgMTBoMXExNDctOCAyODAtNjd0MjM4LTE2NHExMDQtMTA0IDE2NC0yMzh0NjctMjgweiIgaG9yaXotYWR2LXg9Ijc4NS43IiAvPgoKPGdseXBoIGdseXBoLW5hbWU9ImxpbmtlZGluIiB1bmljb2RlPSImI3hmMGUxOyIgZD0iTTE5NSA1MDF2LTU1M2gtMTg0djU1M2gxODR6IG0xMiAxNzFxMC00MS0yOS02OHQtNzUtMjdoLTFxLTQ2IDAtNzQgMjd0LTI4IDY4cTAgNDEgMjkgNjh0NzUgMjcgNzQtMjcgMjktNjh6IG02NTAtNDA3di0zMTdoLTE4M3YyOTZxMCA1OS0yMyA5MnQtNzEgMzNxLTM1IDAtNTgtMTl0LTM2LTQ4cS02LTE3LTYtNDV2LTMwOWgtMTg0cTEgMjIzIDEgMzYxdDAgMTY1bC0xIDI3aDE4NHYtODBoLTFxMTEgMTggMjMgMzF0MzEgMjkgNDkgMjQgNjQgOXE5NSAwIDE1My02M3Q1OC0xODZ6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0iZ2l0aHViIiB1bmljb2RlPSImI3hmMTEzOyIgZD0iTTM1NyAxNzFxMC0yMi03LTQ1dC0yNC00My00MC0xOS00MSAxOS0yNCA0My03IDQ1IDcgNDYgMjQgNDMgNDEgMTkgNDAtMTkgMjQtNDMgNy00NnogbTM1NyAwcTAtMjItNy00NXQtMjQtNDMtNDAtMTktNDEgMTktMjQgNDMtNyA0NSA3IDQ2IDI0IDQzIDQxIDE5IDQwLTE5IDI0LTQzIDctNDZ6IG05MCAwcTAgNjctMzkgMTE0dC0xMDQgNDdxLTIzIDAtMTA5LTEyLTQwLTYtODgtNnQtODcgNnEtODUgMTItMTA5IDEyLTY2IDAtMTA0LTQ3dC0zOS0xMTRxMC00OSAxOC04NXQ0NS01OCA2OC0zMyA3OC0xNyA4My00aDk0cTQ2IDAgODMgNHQ3OCAxNyA2OSAzMyA0NSA1OCAxOCA4NXogbTEyNSA5OXEwLTExNi0zNC0xODUtMjItNDMtNTktNzR0LTc5LTQ4LTk1LTI3LTk2LTEyLTkzLTNxLTQzIDAtNzkgMnQtODIgNy04NSAxNy03NyAyOS02NyA0NS00OCA2NHEtMzUgNjktMzUgMTg1IDAgMTMyIDc2IDIyMS0xNSA0NS0xNSA5NSAwIDY0IDI4IDEyMSA2MSAwIDEwNi0yMnQxMDYtNjlxODIgMjAgMTcyIDIwIDgzIDAgMTU3LTE4IDU4IDQ2IDEwNCA2N3QxMDUgMjJxMjktNTcgMjktMTIxIDAtNDktMTUtOTQgNzYtODkgNzYtMjIyeiIgaG9yaXotYWR2LXg9IjkyOC42IiAvPgoKPGdseXBoIGdseXBoLW5hbWU9InN0YWNrb3ZlcmZsb3ciIHVuaWNvZGU9IiYjeGYxNmM7IiBkPSJNNzE5LTYxaC02MjR2MjY4aC04OXYtMzU3aDgwM3YzNTdoLTkwdi0yNjh6IG0tNTI1IDI5M2wxOCA4NyA0MzctOTItMTgtODd6IG01NyAyMDhsMzggODIgNDA0LTE4OS0zNy04MXogbTExMiAxOTlsNTcgNjkgMzQzLTI4Ny01Ny02OHogbTIyMiAyMTFsMjY2LTM1OC03MS01My0yNjcgMzU3eiBtLTQwMS04MjF2ODloNDQ3di04OWgtNDQ3eiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPgoKPGdseXBoIGdseXBoLW5hbWU9Imluc3RhZ3JhbSIgdW5pY29kZT0iJiN4ZjE2ZDsiIGQ9Ik01NzEgMzUwcTAgNTktNDEgMTAxdC0xMDEgNDItMTAxLTQyLTQyLTEwMSA0Mi0xMDEgMTAxLTQyIDEwMSA0MiA0MSAxMDF6IG03NyAwcTAtOTEtNjQtMTU2dC0xNTUtNjQtMTU2IDY0LTY0IDE1NiA2NCAxNTYgMTU2IDY0IDE1NS02NCA2NC0xNTZ6IG02MSAyMjlxMC0yMS0xNS0zNnQtMzctMTUtMzYgMTUtMTUgMzYgMTUgMzYgMzYgMTUgMzctMTUgMTUtMzZ6IG0tMjgwIDEyM3EtNCAwLTQzIDB0LTU5IDAtNTQtMi01Ny01LTQwLTExcS0yOC0xMS00OS0zMnQtMzMtNDlxLTYtMTYtMTAtNDB0LTYtNTgtMS01MyAwLTU5IDAtNDMgMC00MyAwLTU5IDEtNTMgNi01OCAxMC00MHExMi0yOCAzMy00OXQ0OS0zMnExNi02IDQwLTExdDU3LTUgNTQtMiA1OSAwIDQzIDAgNDIgMCA1OSAwIDU0IDIgNTggNSAzOSAxMXEyOCAxMSA1MCAzMnQzMiA0OXE2IDE2IDEwIDQwdDYgNTggMSA1MyAwIDU5IDAgNDMgMCA0MyAwIDU5LTEgNTMtNiA1OC0xMCA0MHEtMTEgMjgtMzIgNDl0LTUwIDMycS0xNiA2LTM5IDExdC01OCA1LTU0IDItNTkgMC00MiAweiBtNDI4LTM1MnEwLTEyOC0zLTE3Ny01LTExNi02OS0xODB0LTE3OS02OXEtNTAtMy0xNzctM3QtMTc3IDNxLTExNiA2LTE4MCA2OXQtNjkgMTgwcS0zIDQ5LTMgMTc3dDMgMTc3cTUgMTE2IDY5IDE4MHQxODAgNjlxNDkgMyAxNzcgM3QxNzctM3ExMTYtNiAxNzktNjl0NjktMTgwcTMtNDkgMy0xNzd6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0idHVtYmxyIiB1bmljb2RlPSImI3hmMTczOyIgZD0iTTUyNyAxMDhsNDQtMTMycS0xMi0xOS02MS0zN3QtOTktMThxLTU4LTEtMTA3IDE1dC03OSA0MS01MyA1OS0zMSA2Ny05IDY2djMwNGgtOTR2MTIwcTQwIDE0IDcyIDM5dDUxIDUwIDMyIDU3IDE5IDU1IDggNDlxMSAzIDMgNXQ0IDJoMTM2di0yMzdoMTg2di0xNDBoLTE4NnYtMjg5cTAtMTcgMy0zMXQxMy0zMCAyOC0yMyA0NS04cTQ0IDEgNzUgMTZ6IiBob3Jpei1hZHYteD0iNTcxLjQiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0iZHJpYmJibGUiIHVuaWNvZGU9IiYjeGYxN2Q7IiBkPSJNNTcxIDEzcS0yMyAxMzQtNzggMjc4aC0xbC0xLTFxLTktMy0yNC05dC01Ni0yNy03Ny00Ni03My02NC01Ny04MmwtOSA2cTEwMy04NCAyMzQtODQgNzMgMCAxNDIgMjl6IG0tMTAzIDMzOXEtMTEgMjctMjkgNjItMTc0LTUyLTM3Ni01MiAwLTQgMC0xMiAwLTY5IDI0LTEzMnQ2OS0xMTJxMjggNDkgNjkgOTN0ODAgNjkgNzMgNDUgNTUgMjdsMjEgN3EyIDEgNyAydDcgM3ogbS01OSAxMThxLTY3IDExOS0xMzcgMjExLTc3LTM2LTEzMC0xMDR0LTcyLTE1MnExNjkgMCAzMzkgNDV6IG0zODEtMTc4cS0xMTcgMzMtMjI4IDE2IDQ5LTEzMyA3MS0yNjIgNjIgNDIgMTA0IDEwNnQ1MyAxNDB6IG0tNDQ5IDQxNHEtMSAwLTEtMSAwIDEgMSAxeiBtMzI5LTgxcS0xMDMgOTEtMjQxIDkxLTQzIDAtODctMTAgNzMtOTUgMTM3LTIxNCAzOSAxNSA3MyAzNHQ1NCAzNCAzNiAzMiAyMSAyM3ogbTEyNS0yNzFxLTIgMTI5LTgzIDIyOWwtMS0xcS01LTctMTEtMTN0LTI0LTI1LTQwLTM0LTU1LTM2LTc0LTM2cTE0LTMwIDI1LTUzIDEtMyAzLTEwdDUtOXEyMCAyIDQxIDR0NDEgMSAzOS0xIDM1LTIgMzItMyAyNy00IDIwLTMgMTQtM3ogbTYyLTRxMC0xMTctNTctMjE1dC0xNTYtMTU2LTIxNS01OC0yMTYgNTgtMTU1IDE1Ni01OCAyMTUgNTggMjE1IDE1NSAxNTYgMjE2IDU4IDIxNS01OCAxNTYtMTU2IDU3LTIxNXoiIGhvcml6LWFkdi14PSI4NTcuMSIgLz4KCjxnbHlwaCBnbHlwaC1uYW1lPSJza3lwZSIgdW5pY29kZT0iJiN4ZjE3ZTsiIGQ9Ik02NTUgMjU3cTAgMjgtMTEgNTF0LTI3IDM4LTQxIDI3LTQ2IDE5LTQ5IDEzbC01OCAxNHEtMTcgNC0yNSA2dC0xOSA2LTE3IDktOSAxMi00IDE2cTAgNDMgODAgNDMgMjQgMCA0My02dDMwLTE2IDIxLTE5IDIzLTE2IDI3LTdxMjYgMCA0MiAxOHQxNiA0M3EwIDMxLTMyIDU1dC03OSAzOC0xMDEgMTNxLTM4IDAtNzQtOXQtNjctMjYtNDktNDgtMTktNzJxMC0zNCAxMC02MHQzMi00MiA0NC0yNyA1OC0xOGw4MS0yMHE1MS0xMiA2My0yMCAxOC0xMSAxOC0zNCAwLTIxLTIzLTM2dC01OC0xNHEtMjkgMC01MSA5dC0zNyAyMi0yNSAyNS0yNiAyMS0zMCA5cS0yOCAwLTQyLTE3dC0xNC00MXEwLTUyIDY4LTg4dDE2Mi0zN3E0MSAwIDc4IDEwdDY5IDMwIDQ5IDUyIDE5IDc0eiBtMjAyLTEyMXEwLTg5LTYzLTE1MnQtMTUxLTYzcS03MyAwLTEzMSA0NS00My05LTgzLTktODAgMC0xNTMgMzF0LTEyNiA4NC04MyAxMjUtMzEgMTUzcTAgNDEgOSA4NC00NSA1OC00NSAxMzAgMCA4OSA2MyAxNTJ0MTUxIDYzcTczIDAgMTMxLTQ1IDQzIDkgODQgOSA3OSAwIDE1Mi0zMXQxMjYtODQgODQtMTI1IDMwLTE1M3EwLTQxLTgtODQgNDQtNTggNDQtMTMweiIgaG9yaXotYWR2LXg9Ijg1Ny4xIiAvPgoKPGdseXBoIGdseXBoLW5hbWU9InZrb250YWt0ZSIgdW5pY29kZT0iJiN4ZjE4OTsiIGQ9Ik0xMDcwIDU2MHExMy0zNi04NC0xNjQtMTMtMTgtMzYtNDgtMjItMjgtMzEtNDB0LTE3LTI3LTctMjQgOC0xOSAxOC0yNCAzMi0zMHEyLTEgMi0yIDc5LTczIDEwNy0xMjMgMi0zIDQtN3Q0LTE1LTEtMTktMTQtMTUtMzMtN2wtMTQyLTNxLTE0LTItMzIgM3QtMjkgMTNsLTExIDZxLTE3IDEyLTM5IDM2dC0zOCA0My0zNCAzMy0zMiA4cS0xIDAtNC0ydC0xMC04LTEyLTE2LTktMjktNC00NHEwLTgtMi0xNXQtNC0xMGwtMi0zcS0xMC0xMS0zMC0xMmgtNjRxLTQwLTMtODEgOXQtNzQgMjktNTcgMzctNDAgMzJsLTE0IDE0cS01IDUtMTUgMTd0LTQwIDUwLTU5IDg1LTY4IDExNy03MyAxNTJxLTQgOS00IDE1dDIgOWwyIDNxOSAxMSAzMiAxMWwxNTMgMXE3LTEgMTMtM3Q5LTVsMy0ycTktNiAxMy0xOCAxMS0yOCAyNi01N3QyMy00Nmw5LTE2cTE2LTM0IDMxLTU4dDI3LTM4IDIzLTIyIDE5LTggMTUgM3ExIDEgMyAzdDcgMTIgNyAyNiA1IDQ2IDAgNjlxLTEgMjMtNSA0MXQtNyAyNmwtNCA2cS0xNCAxOS00NyAyNC04IDIgMyAxNCA4IDEwIDIxIDE3IDI5IDE0IDEzMyAxMyA0Ni0xIDc1LTcgMTItMyAxOS04dDEyLTEzIDUtMTggMi0yNSAwLTMxLTItNDAgMC00NnEwLTYtMS0yM3QwLTI3IDItMjIgNi0yMiAxMy0xNHE0LTEgOS0ydDE1IDYgMjEgMTkgMjkgMzggMzggNjBxMzMgNTggNjAgMTI1IDIgNiA1IDEwdDYgNmwzIDIgMiAxdDggMiAxMSAwbDE2MCAxcTIyIDMgMzYtMXQxNy0xMHoiIGhvcml6LWFkdi14PSIxMDcxLjQiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0ic2xhY2siIHVuaWNvZGU9IiYjeGYxOTg7IiBkPSJNODQ4IDQxN3EzNCAwIDU3LTIzdDI0LTU2cTAtNTQtNTItNzNsLTk2LTMzIDMxLTkzcTQtMTIgNC0yNiAwLTMzLTI0LTU3dC01Ni0yNHEtMjYgMC00OCAxNXQtMjkgNDBsLTMxIDkyLTE3My01OSAzMS05MXE0LTE0IDQtMjcgMC0zMy0yMy01N3QtNTctMjRxLTI3IDAtNDggMTV0LTI5IDQxbC0zMSA5MS04NS0zMHEtMTctNS0yOC01LTM0IDAtNTcgMjJ0LTIzIDU3cTAgMjYgMTYgNDd0NDAgMzBsODcgMjktNTkgMTc1LTg3LTMwcS0xNC01LTI3LTUtMzMgMC01NiAyM3QtMjMgNTZxMCAyNiAxNSA0OHQ0MCAyOWw4OCAzMC0zMCA4OHEtNCAxNC00IDI3IDAgMzMgMjMgNTd0NTcgMjRxMjYgMCA0OC0xNnQyOS00MGwzMC04OSAxNzMgNTktMzAgODlxLTQgMTMtNCAyNiAwIDMzIDIzIDU3dDU3IDI0cTI2IDAgNDgtMTV0MzAtNDBsMjktOTAgOTEgMzFxMTEgMyAyNCAzIDMzIDAgNTctMjJ0MjQtNTVxMC0yNS0xNy00NXQtNDEtMjlsLTg4LTMwIDU5LTE3NyA5MSAzMnExMyA0IDI2IDR6IG0tNDQzLTE0NmwxNzMgNTgtNTkgMTc2LTE3My02MHoiIGhvcml6LWFkdi14PSI5MjguNiIgLz4KCjxnbHlwaCBnbHlwaC1uYW1lPSJwYXBlci1wbGFuZSIgdW5pY29kZT0iJiN4ZjFkODsiIGQ9Ik05ODQgODQ0cTE5LTEzIDE1LTM2bC0xNDItODU3cS0zLTE2LTE4LTI1LTgtNS0xOC01LTYgMC0xMyAzbC0yNTMgMTA0LTEzNS0xNjVxLTEwLTEzLTI3LTEzLTcgMC0xMiAyLTExIDQtMTcgMTN0LTcgMjF2MTk1bDQ4MiA1OTAtNTk2LTUxNi0yMjEgOTFxLTIwIDgtMjIgMzAtMSAyMyAxOCAzM2w5MjggNTM2cTkgNSAxOCA1IDExIDAgMjAtNnoiIGhvcml6LWFkdi14PSIxMDAwIiAvPgoKPGdseXBoIGdseXBoLW5hbWU9IndoYXRzYXBwIiB1bmljb2RlPSImI3hmMjMyOyIgZD0iTTU1MCAzMDdxNyAwIDU0LTI1dDUwLTMwcTEtMiAxLTggMC0xOC05LTQyLTktMjItNDAtMzd0LTU3LTE1cS0zMiAwLTEwNiAzNS01NSAyNS05NSA2NnQtODIgMTAzcS00MSA2MC00MCAxMDh2NXEyIDUwIDQxIDg4IDE0IDEyIDI5IDEyIDQgMCAxMC0xdDExLTFxMTEgMCAxNS0zdDgtMTZxNS0xMSAxOS00OXQxNC00MXEwLTEyLTE5LTMzdC0yMC0yNnEwLTMgMy04IDE5LTQxIDU3LTc2IDMxLTMwIDg0LTU3IDctNCAxMy00IDggMCAzMCAyN3QyOSAyOHogbS0xMTQtMjk2cTcxIDAgMTM2IDI4dDExMiA3NCA3NSAxMTIgMjggMTM2LTI4IDEzNi03NSAxMTItMTEyIDc1LTEzNiAyOC0xMzUtMjgtMTEyLTc1LTc1LTExMi0yOC0xMzZxMC0xMTMgNjctMjA1bC00NC0xMzAgMTM1IDQzcTg4LTU4IDE5Mi01OHogbTAgNzcxcTg2IDAgMTY0LTM0dDEzNC04OSA5MC0xMzUgMzMtMTYzLTMzLTE2My05MC0xMzQtMTM0LTkwLTE2NC0zNHEtMTA4IDAtMjAzIDUzbC0yMzMtNzUgNzYgMjI2cS02MCA5OS02MCAyMTcgMCA4NiAzMyAxNjN0OTAgMTM1IDEzNCA4OSAxNjMgMzR6IiBob3Jpei1hZHYteD0iODU3LjEiIC8+Cgo8Z2x5cGggZ2x5cGgtbmFtZT0ib2Rub2tsYXNzbmlraSIgdW5pY29kZT0iJiN4ZjI2MzsiIGQ9Ik0zNTcgMzQ0cS0xMDUgMC0xNzkgNzR0LTc0IDE3OXEwIDEwNSA3NCAxNzl0MTc5IDc0IDE3OS03NCA3NS0xNzlxMC0xMDUtNzUtMTc5dC0xNzktNzR6IG0wIDM3OHEtNTEgMC04OC0zN3QtMzYtODhxMC01MiAzNi04OHQ4OC0zNyA4OCAzNyAzNyA4OHEwIDUyLTM3IDg4dC04OCAzN3ogbTI5Mi00MDlxNy0xNSA4LTI3dC0yLTIzLTE1LTIxLTI0LTIxLTM0LTIzcS02NC00MS0xNzYtNTNsNDEtNDAgMTQ5LTE0OXExNy0xNyAxNy00MXQtMTctNDFsLTctN3EtMTctMTctNDEtMTd0LTQxIDE3cS0zOCAzOC0xNDkgMTQ5bC0xNDktMTQ5cS0xOC0xNy00Mi0xN3QtNDAgMTdsLTcgN3EtMTcgMTctMTcgNDF0MTcgNDFsMTQ5IDE0OSA0MCA0MHEtMTEzIDEyLTE3NyA1My0yMSAxNC0zNCAyM3QtMjQgMjEtMTUgMjEtMiAyMyA4IDI3cTYgMTEgMTYgMjB0MjMgMTIgMzItMSAzNi0yMHEzLTIgOC02dDI0LTEzIDM5LTE3IDUxLTE0IDYzLTZxNTEgMCA5NyAxNHQ2NyAyOGwyMSAxNHExOSAxNSAzNyAyMHQzMSAxIDIzLTEyIDE2LTIweiIgaG9yaXotYWR2LXg9IjcxNC4zIiAvPgo8L2ZvbnQ+CjwvZGVmcz4KPC9zdmc+#fontello) format("svg");font-weight:400;font-style:normal}[class*=" icon-"]:before,[class^=icon-]:before{font-family:fontello;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-mail:before{content:"\E800"}.icon-twitter:before{content:"\F099"}.icon-facebook:before{content:"\F09A"}.icon-rss:before{content:"\F09E"}.icon-linkedin:before{content:"\F0E1"}.icon-github:before{content:"\F113"}.icon-stackoverflow:before{content:"\F16C"}.icon-instagram:before{content:"\F16D"}.icon-tumblr:before{content:"\F173"}.icon-dribbble:before{content:"\F17D"}.icon-skype:before{content:"\F17E"}.icon-vkontakte:before{content:"\F189"}.icon-slack:before{content:"\F198"}.icon-paper-plane:before{content:"\F1D8"}.icon-whatsapp:before{content:"\F232"}.icon-odnoklassniki:before{content:"\F263"}.sidebar{width:100%}.sidebar__inner{position:relative;padding:1.5625rem 1.25rem 0}.sidebar__author-photo{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.sidebar__author-title{font-size:1.125rem;font-weight:500;line-height:1.82813rem;margin:.8125rem 0}.sidebar__author-title-link,.sidebar__author-title-link:focus,.sidebar__author-title-link:hover{color:#222}.sidebar__author-subtitle{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.sidebar__copyright{color:#b6b6b6;font-size:.875rem}@media screen and (min-width:685px){.sidebar{width:calc(99.9% * 5/12 - 1.09375rem)}.sidebar:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.sidebar:last-child{margin-right:0}.sidebar:nth-child(12n){margin-right:0;float:right}.sidebar:nth-child(12n+1){clear:both}.sidebar__inner{padding:1.875rem 1.25rem 0}.sidebar__inner:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:540px;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.sidebar{width:calc(99.9% * 1/3 - 1.25rem)}.sidebar:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.sidebar:last-child{margin-right:0}.sidebar:nth-child(3n){margin-right:0;float:right}.sidebar:nth-child(3n+1){clear:both}.sidebar__inner{padding:2.5rem}}.post{margin-bottom:2.03125rem}.post:last-child,.post__title{margin-bottom:.8125rem}.post__title{font-size:1.6875rem;line-height:2.4375rem;margin-top:0}.post__title-link{color:#222}.post__title-link:focus,.post__title-link:hover{color:#222;border-bottom:1px solid #222}.post__description{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.post__meta-time{font-size:.875rem;color:#222;font-weight:500;text-transform:uppercase}.post__meta-divider{margin:0 .3125rem}.post__meta-category-link{font-size:.875rem;color:#f7a046;font-weight:500;text-transform:uppercase}.post__meta-category-link:focus,.post__meta-category-link:hover{color:#5d93ff}.post__readmore{font-size:1rem;color:#5d93ff}.post__readmore:focus,.post__readmore:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.project-single__inner{max-width:71.875rem;padding:0 .9375rem;margin:0 auto}.project-single__title{font-size:2rem;max-width:52.8125rem;margin:1.625rem auto 0;font-weight:600;text-align:center;line-height:2.68125rem}.project-single__body figure{margin-bottom:1.625rem}.project-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.project-single__body figure blockquote p{max-width:52.8125rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.project-single__body a{text-decoration:underline}.project-single__body .gatsby-highlight{max-width:52.8125rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.project-single__body :not(div){max-width:52.8125rem;margin-left:auto;margin-right:auto}.project-single__footer{max-width:52.8125rem;margin:1.625rem .9375rem 3.25rem;line-height:1.625rem}.project-single__footer-text a{text-decoration:underline}.project-single__date{max-width:52.8125rem;margin-left:auto;margin-right:auto}.project-single__tags{margin-bottom:.8125rem}.project-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.project-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.project-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.project-single__tags-list-item-link:focus,.project-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.project-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.project-single__home-button:focus,.project-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.project-single__body .gatsby-highlight,.project-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.project-single__inner{padding:0}.project-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.project-single__body,.project-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.project-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}.project{margin-bottom:2.03125rem}.project:last-child,.project__title{margin-bottom:.8125rem}.project__title{font-size:1.6875rem;line-height:2.4375rem;margin-top:0}.project__title-link{color:#222}.project__title-link:focus,.project__title-link:hover{color:#222;border-bottom:1px solid #222}.project__description{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.project__meta-time{font-size:.875rem;color:#222;font-weight:500;text-transform:uppercase}.project__meta-divider{margin:0 .3125rem}.project__meta-category-link{font-size:.875rem;color:#f7a046;font-weight:500;text-transform:uppercase}.project__meta-category-link:focus,.project__meta-category-link:hover{color:#5d93ff}.project__readmore{font-size:1rem;color:#5d93ff}.project__readmore:focus,.project__readmore:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.project__github{float:right}</style></head><body><div id="___gatsby"><div class="layout" data-reactroot="" data-reactid="1" data-react-checksum="831387472"><!-- react-empty: 2 --><div data-reactid="3"><!-- react-empty: 4 --><div data-reactid="5"><div data-reactid="6"><a class="post-single__home-button" href="/" data-reactid="7">All Articles</a></div><div class="post-single" data-reactid="8"><div class="post-single__inner" data-reactid="9"><h1 class="post-single__title" data-reactid="10">Exploring Object Layouts</h1><p data-reactid="11"></p><div class="post-single__body" data-reactid="12"><h1>Background</h1>
<p>The yearly <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8">“Performance improvements in .NET” blog post</a> is always a treasure trove of low-level knowledge on performance. This latest edition had several examples of significant improvements as a result of allocating smaller objects, rather than allocating less frequently. Of course no allocations are even better but at the same time allocations are part of life so they are unavoidable to some degree.<br>
Take <a href="https://github.com/dotnet/runtime/pull/81251">PR #81251</a> for example: by replacing a couple of fields with a well-known value on an existing <code class="language-text">int</code> field, we can reduce the overall size of each object. After a bit of browsing I spotted <a href="https://github.com/dotnet/runtime/blob/b6b00ec9f606eca0c47e01b30e74ee0d37d561ab/src/libraries/System.Net.Ping/src/System/Net/NetworkInformation/Ping.cs#L21-L31">a similar pattern</a> in <code class="language-text">Ping</code> where it seemed I would be able to apply the same idea: <code class="language-text">bool _canceled</code> and <code class="language-text">bool _disposeRequested</code> could just as easily be flags for the existing <code class="language-text">int _status</code> field. The <code class="language-text">_status</code> field only supports a few values right now so we can easily tack more on.</p>
<p>After a bit of playing around to figure out how to build the runtime locally and run a comparison benchmark, I ended up with this PR: <a href="https://github.com/dotnet/runtime/pull/94151">https://github.com/dotnet/runtime/pull/94151</a>. Lo and behold, BenchmarkDotNet claims we allocated the same amount after my changes. How is that possible when it literally stores less data?</p>
<h1>Diagnosis</h1>
<p>At first I looked at the issue through <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools">WinDbg</a>. To make things easy for ourselves we’ll create two class definitions with the fields of the <code class="language-text">Ping</code> class with and without the two booleans:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>NetworkInformation<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ping2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Debugger<span class="token punctuation">.</span><span class="token function">Break</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Ping</span> <span class="token punctuation">:</span> <span class="token class-name">Component</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ManualResetEventSlim</span> _lockObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManualResetEventSlim</span><span class="token punctuation">(</span>initialState<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// doubles as the ability to wait on the current operation</span>
    <span class="token keyword">private</span> SendOrPostCallback<span class="token operator">?</span> _onPingCompletedDelegate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">bool</span> _disposeRequested<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">?</span> _defaultSendBuffer<span class="token punctuation">;</span>
    <span class="token keyword">private</span> CancellationTokenSource<span class="token operator">?</span> _timeoutOrCancellationSource<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">bool</span> _canceled<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> _status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> PingCompletedEventHandler<span class="token operator">?</span> PingCompleted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Ping2</span> <span class="token punctuation">:</span> <span class="token class-name">Component</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ManualResetEventSlim</span> _lockObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManualResetEventSlim</span><span class="token punctuation">(</span>initialState<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// doubles as the ability to wait on the current operation</span>
    <span class="token keyword">private</span> SendOrPostCallback<span class="token operator">?</span> _onPingCompletedDelegate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">?</span> _defaultSendBuffer<span class="token punctuation">;</span>
    <span class="token keyword">private</span> CancellationTokenSource<span class="token operator">?</span> _timeoutOrCancellationSource<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> _status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> PingCompletedEventHandler<span class="token operator">?</span> PingCompleted<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Compile this in release mode (<code class="language-text">dotnet build -c Release</code>) and load the .exe in WinDbg, you’ll see something along these lines:</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-fb2e5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 54.392815306520895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABm0lEQVQoz32S63LbIBCF9f6v1Z+dps0kzji+xEboZl1BSAghy6cLjh3H05qZb0AsnD27Ivix2CNODuA8AeMpFtsY+7hEXjQoK4nqHzS1hBDqStMo1LWLCQRP6wjLXUwfDUTbo5Y9ZDdAGws9WPTDSJxnt1fLDvxQUUJKmpcoaC7LCsaMUKpHoKREliYUKND3HY7HCdNkiQmn0wn3Q5HoMinAGCP22LMdsizxMXcnkK2iDC5b7pGUwBhDwkcveIsXJKfrtEQURQjDkGDIDqmPWWsROMtCCI9Syl+c5/nq6CJ0FaTS1tlZ8AxHkkRfgoyF2G63vgTn0Lm9CN6KXdYtOVwmuXfHCVd2ksZfgh8fO7y+vuBt8YbNZoPVauV7cSt0X/I79ZBz7nEOv5VcVbUvt+97aK19/x6NbpzwnhbenesfI9LbnyKkgp2OGOmg+WSgPunB+Nm456ONfxJaDyhFC5bXVGZGQgdPWVUY7YSu0whmO17a/8DXDDuQoJJom+r/Z2dy+HNX4zlW+BM95hdr8JvLu7PtFbf/FAr8BafiSDqW/C5cAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="WinDbg loaded"
        title=""
        src="/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-c83f1.png"
        srcset="/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-569e3.png 240w,
/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-93400.png 480w,
/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-c83f1.png 960w,
/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-23e13.png 1440w,
/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-10d8f.png 1920w,
/static/windbg-load-90d85e6794c14cb07409b794b5c15b71-fb2e5.png 2561w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Next, run the program so it hits the breakpoint we set via <code class="language-text">Debugger.Break()</code>:</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code class="language-bash">g</code></pre>
      </div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-fb2e5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 54.392815306520895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByklEQVQoz4WS6Y6bMBSFef+n6iL1Ryt1U5s0URLAxmAwmMVsYTu9diaNZqZVLR2BfK+/u3rvfgaIhATnCXgksTvHCEQOlVfIixrFX1TqGlVlHioNtLa2Ct53P8UlyiBThVgqSKVR1i26fkQ/TOiGK+n2HcYZOT3mKQVUVgWyLEemFMZxgjEdPJ3nFEFTBI2mrrFtK7Z1xb9ORYF2IkMUcaqKIQgDiJg52zzP8BiPcD6fwRijiIrS1lgWgm4gbc9kT9n2OMQKSZJACOGgiRTONk0TARnHfr/H4XCAf7k4+LIsrzJ7CYzjmLKMCBohTZMH0PcDXAhijVJKMqbUj9HJlmDhK7XABSFo0XTYU8k2O/smZAEY9x/AIAhddlYsDOH7Pk23QE39tLJONrv1qa/a3DK8AxkLX5QcMhyPR5xOJ+d076XWBfWzQNd1f2BuKN2AX3HmYJxzN5xExo+hxEkKXVaoagPTdrQuA63HFb1bm5vsnaHeDfSvygYs0zQUSaCU1i2lnc1xnWa05ONtRP3v2Rb0pkFVKOR2APPVXr72W6jkT36Br5EhNU/f5/omDL7wGh+OEm93Ed78YHi/F/ho34n7u4b8WnwOS/wGosBCfIEQMccAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Breakpoint is hit and stacktrace is visible"
        title=""
        src="/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-c83f1.png"
        srcset="/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-569e3.png 240w,
/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-93400.png 480w,
/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-c83f1.png 960w,
/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-23e13.png 1440w,
/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-10d8f.png 1920w,
/static/windbg-breakpoint-443f60871aad5056ca7ce68b8a0299d0-fb2e5.png 2561w"
        sizes="(max-width: 960px) 100vw, 960px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>At this point we can look for our previously-created <code class="language-text">Ping</code> objects with something like this:</p>
<div class="gatsby-highlight">
      <pre class="language-bash"><code class="language-bash"><span class="token operator">!</span>dumpheap -stat -type Ping</code></pre>
      </div>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/windbg-dumpheap-f6340caba0e8adbcd9ad16c9ffb61756-7f9db.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 342px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 35.96491228070175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABkklEQVQozzVRa2/aQBDk//+bVkpVpcmHhFDUBNsUHBswftuxjevnYRsIaDpnKR9Od7s7Nzs7OynLBm9vr5jNZrB2Fuz9HouFAlVVoWkaHNfFnrksO6BtW6RpgrIskSQJDoccH3GElLXT+YyuO2JSlDX+Lpd4fp5itdJ5VlgoGizLwt62kec5fM9DEIQoigKmacJl7HsuDMNE0wr0fY+6rlGw0aRpjohCH3Ec8Mjbg21v4fs+PH6U6qIoGpVvNhu4VHzIMtZ8hGEA13GwXq8REiNJSdhxLEFgQ1UtHEdw5BBr3cN2a0JRlJFY13XGuzFWVQVLTcV8PifeZW4xWtM0JKyqDk9PPR5+Dfj+rcOPnx3u7i7YWQOunwO9SlE3DYaB8fXK0YOR9F1fYTp9QZJmOJ0GtMRIb0kouBALj48bzH+HeJm5uL838efV4Ej+OLL0dceFvRsGVW5HCz7ieHzLhpJI+jsSCtFDiApVlbOTwPFY41+REpAzV7MmUBIsP2T0ruUSpNLL5RO32433BWdu+Ov8B73y/gOhfkVhAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Two results for classes Ping and Ping2"
        title=""
        src="/static/windbg-dumpheap-f6340caba0e8adbcd9ad16c9ffb61756-7f9db.png"
        srcset="/static/windbg-dumpheap-f6340caba0e8adbcd9ad16c9ffb61756-d14e5.png 240w,
/static/windbg-dumpheap-f6340caba0e8adbcd9ad16c9ffb61756-7f9db.png 342w"
        sizes="(max-width: 342px) 100vw, 342px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Immediately we can see that both <code class="language-text">Ping</code> and <code class="language-text">Ping2</code> have one instance each. Crucially, both show up as having a total size of 80 bytes. This aligns with our BenchmarkDotNet findings that no allocation reduction was realised.</p>
<p>To investigate deeper we can click on the link for the <code class="language-text">7ffcb254c7b8</code> Method Table which will execute <code class="language-text">!dumpheap -mt 7ffcb254c7b8</code>. This then tell us that the memory address for that object is located at <code class="language-text">01c0e5cc6ed0</code>. </p>
<p>Clicking that link then executes <code class="language-text">!dumpobj /d 1c0e5cc6ed0</code> which gives us this nice overview of the object:</p>
<div class="gatsby-highlight">
      <pre class="language-log"><code class="language-log">0:000&gt; !dumpobj /d 1c0e5cc6ed0
Name:        Ping2
MethodTable: 00007ffcb254c7b8
EEClass:     00007ffcb2561b28
Tracked Type: false
Size:        80(0x50) bytes
File:        C:\Users\jer_v\source\repos\pingsize\pingsize\bin\Release\net8.0\pingsize.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
0000000000000000  4000019        8 ...ponentModel.ISite  0 instance 0000000000000000 _site
0000000000000000  400001a       10 ....EventHandlerList  0 instance 0000000000000000 _events
00007ffcb2265fa0  4000018       98        System.Object  0   static 0000000000000000 s_eventDisposed
00007ffcb254d520  4000009       18 ...ualResetEventSlim  0 instance 000001c0e5cc6f20 _lockObject
00007ffcb22a92d0  400000a       20          System.Void  0 instance 0000000000000000 _onPingCompletedDelegate
00007ffcb2431f88  400000b       28        System.Byte[]  0 instance 0000000000000000 _defaultSendBuffer
00007ffcb22a92d0  400000c       30          System.Void  0 instance 0000000000000000 _timeoutOrCancellationSource
00007ffcb22c2158  400000d       40          System.Byte  1 instance                0 _status
00007ffcb22a92d0  400000e       38          System.Void  0 instance 0000000000000000 PingCompleted</code></pre>
      </div>
<p>Excellent! Now we see the exact layout of our fields in the object. Worth noting here that the object is 80 bytes — in decimal. In hexadecimal, that corresponds to 0x50. This is particularly relevant because the <code class="language-text">Offset</code> column specifies its values in hexadecimal as well.</p>
<p>Note that the CLR chooses the most optimal layout for us. We can override this behaviour in structs so beware when using <code class="language-text">LayoutKind.Sequential</code>!</p>
<blockquote>
<p><strong>Object Layout</strong>  </p>
<p>At this point we’ll take a step back and revise some CLR fundamentals: what does an object look like? For simplicity we’ll focus on 64-bit systems here. That means we can assume references are 8 bytes and objects (as a whole) are padded to an 8-byte boundary. Furthermore, every object contains two references by default: the Object Header and a reference to the Method Table. Both are 8 bytes so we know that the resulting object will be at least 16 bytes in size before we’ve even started counting our fields.</p>
<p>Interestingly, the Method Header is actually defined with a negative offset (i.e. <code class="language-text">-8 bytes</code>). So our actual object at offset <code class="language-text">0</code> is the Method Table reference.</p>
</blockquote>
<p>With this knowledge in mind we can now use the offsets in the above output to show how the object is laid out. To simplify our life, we write a small console script to help with translating hexadecimal to decimal:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"{i}: {i:x}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>This outputs:</p>
<div class="gatsby-highlight">
      <pre class="language-log"><code class="language-log">0: 0
8: 8
16: 10
24: 18
32: 20
40: 28
48: 30
56: 38
64: 40
72: 48
80: 50
88: 58
96: 60</code></pre>
      </div>
<p>Armed with this information we can deduce the following object layout:</p>
<div class="gatsby-highlight">
      <pre class="language-log"><code class="language-log">Field                        Offset (hex)  Offset (dec)    Size (bytes)
&lt;Object Header&gt;             -0x08         -8               8
&lt;Method Table Pointer&gt;       0x00          0               8
_site                        0x08          8               8
_events                      0x10          16              8
_lockObject                  0x18          24              8
_onPingCompletedDelegate     0x20          32              8
_defaultSendBuffer           0x28          40              8
_timeoutOrCancellationSource 0x30          48              8
PingCompleted                0x38          56              8
_status                      0x40          64              4
_disposeRequested            0x44          68              1
_canceled                    0x45          69              1</code></pre>
      </div>
<blockquote>
<p><strong>Object sizes</strong></p>
<p>References are 8 bytes, but <code class="language-text">int</code> is a 32-bit integer (i.e. 4 bytes) while booleans are defined as a single byte.</p>
</blockquote>
<p>This gives us a total range of <code class="language-text">-0x08</code> to <code class="language-text">0x46</code>, which equates to <code class="language-text">0x4e</code> or 78 bytes. What gives? </p>
<p>Remember the <em>Object Layout</em> section from above:</p>
<blockquote>
<p>(..) are padded to an 8-byte boundary</p>
</blockquote>
<p>78 is not a multiple of 8 so we need to add padding for that. Specifically, we need to add two bytes worth of padding (rounding up to the nearest multiple) so our object actually becomes</p>
<div class="gatsby-highlight">
      <pre class="language-log"><code class="language-log">Field                        Offset (hex)  Offset (dec)    Size (bytes)
&lt;Object Header&gt;             -0x08         -8               8
&lt;Method Table Pointer&gt;       0x00          0               8
_site                        0x08          8               8
_events                      0x10          16              8
_lockObject                  0x18          24              8
_onPingCompletedDelegate     0x20          32              8
_defaultSendBuffer           0x28          40              8
_timeoutOrCancellationSource 0x30          48              8
PingCompleted                0x38          56              8
_status                      0x40          64              4
_disposeRequested            0x44          68              1
_canceled                    0x45          69              1
&lt;Padding&gt;                    0x46          70              2</code></pre>
      </div>
<p>This now gives us a valid object of 80 bytes. It also immediately makes it clear why our optimisation didn’t work: if you remove <code class="language-text">_disposeRequested</code> and <code class="language-text">_canceled</code> from the object definition then we end up with 76 bytes which is also not a multiple of 8. As a result, the CLR will introduce four bytes of padding and end up with an 80-byte object once again.</p>
<h1>Simplified Diagnosis</h1>
<p>Spelunking through WinDbg is certainly not trivial! Fortunately, there are projects out there that will help us a long way here. Using the <a href="https://github.com/SergeyTeplyakov/ObjectLayoutInspector">ObjectLayoutInspector</a> we can inspect the object size at runtime and print out a helpful overview. Add a reference to its NuGet package (<code class="language-text">&lt;PackageReference Include=&quot;ObjectLayoutInspector&quot; Version=&quot;0.1.4&quot; /&gt;</code>) and add the following to our application:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp">ObjectLayoutInspector<span class="token punctuation">.</span>TypeLayout<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PrintLayout</span><span class="token punctuation">&lt;</span><span class="token class-name">Ping2</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Run the console application and we can see the following output:</p>
<div class="gatsby-highlight">
      <pre class="language-log"><code class="language-log">Type layout for &#39;Ping&#39;
Size: 64 bytes. Paddings: 2 bytes (%3 of empty space)
|=======================================================================|
| Object Header (8 bytes)                                               |
|-----------------------------------------------------------------------|
| Method Table Ptr (8 bytes)                                            |
|=======================================================================|
|   0-7: ISite _site (8 bytes)                                          |
|-----------------------------------------------------------------------|
|  8-15: EventHandlerList _events (8 bytes)                             |
|-----------------------------------------------------------------------|
| 16-23: ManualResetEventSlim _lockObject (8 bytes)                     |
|-----------------------------------------------------------------------|
| 24-31: SendOrPostCallback _onPingCompletedDelegate (8 bytes)          |
|-----------------------------------------------------------------------|
| 32-39: Byte[] _defaultSendBuffer (8 bytes)                            |
|-----------------------------------------------------------------------|
| 40-47: CancellationTokenSource _timeoutOrCancellationSource (8 bytes) |
|-----------------------------------------------------------------------|
| 48-55: PingCompletedEventHandler PingCompleted (8 bytes)              |
|-----------------------------------------------------------------------|
| 56-59: Int32 _status (4 bytes)                                        |
|-----------------------------------------------------------------------|
|    60: Boolean _disposeRequested (1 byte)                             |
|-----------------------------------------------------------------------|
|    61: Boolean _canceled (1 byte)                                     |
|-----------------------------------------------------------------------|
| 62-63: padding (2 bytes)                                              |
|=======================================================================|</code></pre>
      </div>
<p>This confirms out WinDbg findings: padding is applied to the end of the object and we’re seeing 16 bytes of overhead.</p>
<h1>Conclusion</h1>
<p>In this case, padding is inevitable. Even if we were to replace the <code class="language-text">int _status</code> with a <code class="language-text">byte _status</code>, we’d still use a single <code class="language-text">byte</code> on top of the previous boundary and thus incur seven bytes of padding. As a result, moving these fields into the status enum will gain no benefit from an object size perspective. </p>
<p>This type of optimization shows most promise when used in a type that has multiple fields smaller than the pointer size — we only see effects if we’re able to go down to a lower multiple of our byte boundary. Of course, removing a reference field entirely will always yield results!</p></div><div class="post-single__date" data-reactid="13"><em data-reactid="14"><!-- react-text: 15 -->Published <!-- /react-text --><!-- react-text: 16 -->30 Oct 2023<!-- /react-text --></em></div></div><div class="post-single__footer" data-reactid="17"><div class="post-single__tags" data-reactid="18"><ul class="post-single__tags-list" data-reactid="19"><li class="post-single__tags-list-item" data-reactid="20"><a class="post-single__tags-list-item-link" href="/tags/c/" data-reactid="21">C#</a></li><li class="post-single__tags-list-item" data-reactid="22"><a class="post-single__tags-list-item-link" href="/tags/clr/" data-reactid="23">CLR</a></li><li class="post-single__tags-list-item" data-reactid="24"><a class="post-single__tags-list-item-link" href="/tags/win-dbg/" data-reactid="25">WinDbg</a></li></ul></div><hr data-reactid="26"/><p class="post-single__footer-text" data-reactid="27"><!-- react-text: 28 -->Unearthing curious .NET behaviour<!-- /react-text --><a href="https://twitter.com/VannevelJeroen" target="_blank" rel="noopener noreferrer" data-reactid="29"><br data-reactid="30"/><!-- react-text: 31 --> <!-- /react-text --><strong data-reactid="32">Jeroen Vannevel</strong><!-- react-text: 33 --> on Twitter<!-- /react-text --></a></p><!-- react-text: 34 --><!-- /react-text --></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-cac8019cf2acad5c70a4.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","108009296967943":"component---src-templates-post-template-jsx-4c1c99dd96b73e8d9acd.js","2638498282051":"component---src-templates-tag-template-jsx-2b3726fa7cce65b202ed.js","90179704293519":"component---src-templates-category-template-jsx-801615e0ee15486d4622.js","153596302435155":"component---src-templates-project-template-jsx-1cf79d1513af6bee36b2.js","183328146348521":"component---src-pages-404-jsx-265d0c38bdff4d0a90c6.js","142542727794042":"component---src-pages-categories-jsx-2da18a892adca87ae12e.js","213534597649335":"component---src-pages-index-jsx-64649fde84da96ead11c.js","19843951674672":"component---src-pages-projects-jsx-4e20184c7619564550e1.js","36530248567819":"component---src-pages-tags-jsx-e787e63a56bf6859a224.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","210013022422731":"path---posts-what-is-unit-testing-95d6f2573c9b409058b5.js","194347916880816":"path---tags-unit-testing-5de56445271aa258a418.js","163783469962619":"path---categories-testing-60f851aa38356fafb836.js","57414648566179":"path---posts-how-to-configure-a-custom-identityuser-for-entity-framework-5a9c25079a6845ec9d8d.js","99965129943657":"path---tags-c-66691279197684019e00.js","158948812405505":"path---tags-asp-net-ed4ad86ca9b44b663556.js","43594519827409":"path---tags-entity-framework-f298be598e118803852e.js","96001935442096":"path---categories-asp-net-e31f743693c54161bad8.js","10833908716903":"path---posts-hello-linux-e8bb8ffdccfc58a7b569.js","102626217677571":"path---tags-net-c52371b1802c9fea5cc2.js","115329724643966":"path---tags-linux-780ded64475ccd7382c0.js","6486568870292":"path---tags-visual-studio-code-52f82a2a0f1d2fa39229.js","72987173723140":"path---tags-dnx-e277d4ed2ad54934f706.js","55906874678431":"path---categories-net-462e661d6aa41e76591a.js","60123928662786":"path---posts-introducing-roslyntester-e47ea76b322b9a9d3c36.js","186975418890208":"path---tags-roslyn-bfd0ed7f6f9135a85179.js","210199730923038":"path---tags-diagnostics-0e494793b4f73d771afc.js","128504387138817":"path---categories-roslyn-38d382f730c85cc60998.js","154656482558507":"path---posts-introducing-vsdiagnostics-8d7b5269deab3129ab05.js","194622622375975":"path---tags-visual-studio-20f5976881b9071df931.js","225248144606594":"path---posts-a-few-important-roslyn-api-helpers-fc7833b3166297c719a4.js","171537721535774":"path---tags-nu-get-ed1329087d4316d7a4b0.js","256292793965140":"path---tags-ms-build-a5a3da84f4abef9963fa.js","102038638384165":"path---posts-quick-tip-getting-a-variables-data-during-debugging-48b619bb2bc702137d14.js","96054509920718":"path---tags-debugging-885008945f4ae50f623c.js","132891409650980":"path---categories-debugging-2820d87cc5da9d732477.js","33884994942753":"path---posts-generating-a-nuget-package-in-a-localized-directory-on-each-build-a35b46309c66298dba35.js","244522834873248":"path---categories-ms-build-2403c789de82c2f272e0.js","32744716682477":"path---posts-launching-your-first-webapp-in-visual-studio-code-through-gulp-aaa4493321fc1b372b6f.js","177761263186651":"path---tags-gulp-19272be8ec527a3799ec.js","96407400828738":"path---tags-angular-js-81d9735f40f7e3d2f147.js","102352008175747":"path---categories-web-dev-dc6e98d29ca83527e381.js","174911327774741":"path---posts-evaluating-chrome-devtools-a31722836ed767387914.js","212641908305216":"path---tags-java-script-a81b76dd22dca0d1eeb8.js","175067220764720":"path---tags-google-chrome-33760c7b5b4fefb5d8f3.js","43252960977049":"path---posts-exposing-elasticsearch-from-azure-vm-e183a0dae42611032a95.js","123539316595192":"path---tags-azure-6fba57a14eaffe187955.js","235219157580732":"path---tags-elastic-search-6c3a5e3c179019493122.js","96633899600425":"path---categories-cloud-a8f833769ff9400cb601.js","57119089648606":"path---posts-caching-azure-devops-artifacts-a074971e2870b89d1a1c.js","48587552827621":"path---tags-dev-ops-85b8002b00764c94849e.js","50336800766067":"path---tags-ci-cd-591dca69864d24a1a392.js","154099399247373":"path---posts-quick-and-easy-https-on-azure-web-app-d4c4e0aa09681dbfbe98.js","246471908066498":"path---posts-releasing-android-through-azure-devops-5540e8721cad231b4971.js","268242096314276":"path---tags-android-6c0bf24e860b86c4fb14.js","18321015886960":"path---posts-deploying-to-github-packages-through-azure-devops-692fe99ef9a6a7130684.js","52270612062531":"path---posts-better-diagrams-through-dot-8b034c3acba63576e367.js","129258703369878":"path---tags-dot-dabaf1af019613879849.js","60612898588123":"path---tags-diagrams-74aeff52e6e569b34bad.js","27220730532121":"path---categories-architecture-ecf3a436dbc65517005a.js","231296083139248":"path---posts-executing-commands-in-terminal-from-swift-438599b03a6ce8de42fe.js","111756103677632":"path---tags-swift-3c8d59a9a6e65a210c61.js","18729388301380":"path---tags-apple-script-01fc7b20433976ce4c9c.js","146583274104328":"path---tags-terminal-b7fef55222bc3619dd99.js","274653444909769":"path---categories-mac-os-99b3ad38c0a97df19e67.js","12724831829617":"path---posts-translating-react-native-apps-a208e485b531f700f805.js","164326542535565":"path---tags-react-native-5e1f9e0f4e7c953dc013.js","51720743109199":"path---tags-typescript-367b4e2d3697c53e60f0.js","157567642992813":"path---categories-react-native-d4255c73e69bba64164e.js","158676170299019":"path---posts-unit-testing-redux-persist-migrations-with-typescript-99ff70b2313c18c0f1b2.js","84586273293571":"path---tags-react-0854209acbdb70fd112b.js","280540150479307":"path---posts-visualizing-the-language-migration-of-a-codebase-e8543bdeea0cb33ce3d4.js","67335324583948":"path---tags-javascript-1ec770346886a569811e.js","38511735442254":"path---tags-bash-005dbc571427ff526ec1.js","76377051725678":"path---tags-shell-f83f08742fdfaf1380a6.js","190941786186016":"path---posts-market-research-senior-engineer-in-london-961088195ad71c15a7fd.js","198917514091517":"path---tags-career-bec725ac05fb7e983325.js","10593661446306":"path---categories-career-29d89d7db392d355a131.js","138521039928834":"path---posts-byte-sized-thoughts-expertise-ec67e5111d65629c69f4.js","81309768047879":"path---tags-software-engineering-76f709ede06e1418cf08.js","117351500195390":"path---categories-byte-sized-thoughts-550b62e6eb8bfd985490.js","89559757442363":"path---projects-redditcrap-05b7b714b3ea009a7679.js","173497357565469":"path---categories-social-5212a48a1eb06088d9b9.js","92705000446431":"path---projects-roslyntester-02b8bf4a070023021197.js","100669912497244":"path---categories-dev-tools-4e0b9f63dabac71cc588.js","118339820481791":"path---projects-vsdiagnostics-c2823976b4eef85ba0cd.js","125786144107852":"path---posts-properly-testing-entity-framework-with-effort-2b3f74bfdc45c88a2113.js","257155450825018":"path---posts-unit-testing-web-api-routes-and-parameter-validation-89d647b628b58dd0fa73.js","31221279016344":"path---tags-routing-07bd0d251139fd3aead9.js","225042621602343":"path---posts-unit-testing-your-owin-configured-oauth-2-implementation-1e2bbe1e98023d993765.js","31071873732760":"path---tags-dependency-injection-868075ff78c11ab474d9.js","273162457360029":"path---tags-authentication-ec49c87ec8242317de91.js","109586088525438":"path---posts-getting-started-with-your-first-diagnostic-6c5f7e03efac47ca5fe5.js","267124642010291":"path---posts-here-be-dragons-string-concatenation-894e6308f68bd07b3167.js","85273878220361":"path---tags-performance-24b4f75e43346d174928.js","274987976086560":"path---categories-performance-fbd33f180f3c858c788c.js","204656974653008":"path---posts-using-taskcompletionsource-to-change-the-semantics-of-async-calls-6465659ed886dbb03f62.js","48914037011886":"path---posts-plotting-stacked-bar-charts-in-rust-e63824a36a44adff020d.js","258905265707556":"path---tags-rust-def152b83c3ea7d2d526.js","107803621565589":"path---categories-rust-bc885363aee5ee5b9426.js","127418175428226":"path---posts-exploring-object-layouts-e1f1c760dc7df59bbfc5.js","192160952716614":"path---tags-clr-c9f69febe8beaba514a8.js","127268671954243":"path---tags-win-dbg-c7259ef0979e3d87ca03.js","254022195166212":"path---404-3611101330d3542e466d.js","30875753179511":"path---categories-30db25348389116085cb.js","142629428675168":"path---index-84a17ee537ed284731fa.js","97786326051841":"path---projects-213d36fe7cc2d426d62c.js","55702396619907":"path---tags-30ea7919dec75e34c6ac.js","178698757827068":"path---404-html-3611101330d3542e466d.js","79611799117203":"component---src-layouts-index-jsx-06f008698c6b616768bb.js"}/*]]>*/</script><script>
            
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-P4QRR77NWC',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-P4QRR77NWC', 'auto');
      ga('set', 'anonymizeIp', 1);}
      </script><script>/*<![CDATA[*/["/commons-50675cee3a38850a85f7.js","/app-cac8019cf2acad5c70a4.js","/path---posts-exploring-object-layouts-e1f1c760dc7df59bbfc5.js","/component---src-templates-post-template-jsx-4c1c99dd96b73e8d9acd.js","/component---src-layouts-index-jsx-06f008698c6b616768bb.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>